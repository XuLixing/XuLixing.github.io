<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Introduction to My Blog</title>
    <url>/2021/04/13/blog-inro/</url>
    <content><![CDATA[<p>This is my blog, built at March, 2021, supported by Github &amp; Hexo &amp; NexT Theme.</p>
<p>Accumulation does matter.</p>
<p>This blog would serve as window, where I could share my my points, output fantastic ideas and trace any change inside my mind.</p>
<p>For Now, I would focus more on producing notes and posts from my leanrning, as many as possible.</p>
<p>I hope that what i will write or i have wrriten would make a difference to the world.</p>
]]></content>
      <tags>
        <tag>Introduction</tag>
      </tags>
  </entry>
  <entry>
    <title>5. Memory Hierachy</title>
    <url>/2021/11/07/computer-architecture/5.memory-hierachy/</url>
    <content><![CDATA[<h1 id="5-1-Memory-Hierachiy-Overview"><a href="#5-1-Memory-Hierachiy-Overview" class="headerlink" title="5.1  Memory Hierachiy Overview"></a>5.1  Memory Hierachiy Overview</h1><h2 id="5-1-1-Memory-development"><a href="#5-1-1-Memory-development" class="headerlink" title="5.1.1 Memory development"></a>5.1.1 Memory development</h2><p>Memoryçš„æ€§èƒ½å‘å±•å¹¶æ²¡æœ‰è·Ÿä¸ŠCPUçš„æ€§èƒ½ï¼Œåœ¨è®¡ç®—æœºè¿ç®—ï¼ˆCPUå’ŒMemoryååŒï¼‰å†…å­˜çš„è®¿é—®æ—¶é—´å³æ•°æ®çš„æ¬è¿æ—¶é—´è¿‡é•¿ï¼Œåˆ¶çº¦äº†è®¡ç®—æ€§èƒ½ã€‚å¤„ç†å™¨çš„æ€§èƒ½çš„å‘å±•é€Ÿåº¦è¿œè¶…äºå†…å­˜ï¼ˆå¦‚DRAMï¼‰çš„å‘å±•é€Ÿåº¦ï¼Œè¿™é‡Œæœ‰ç”µè·¯è®¾è®¡ä¼˜åŒ–çš„å› ç´ ï¼Œä¹Ÿæœ‰å·¥è‰ºçš„å› ç´ ã€‚å¤„ç†å™¨å¦‚æœéœ€è¦å¿«é€Ÿçš„å¤„ç†æ•°æ®ï¼Œæ— è®ºæ˜¯æŒ‡ä»¤è¿˜æ˜¯æ•°æ®ï¼Œå­˜å‚¨ç³»ç»Ÿéƒ½åº”è¯¥èƒ½å¤Ÿå¿«é€Ÿä¾›ç»™ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Memory%20Hierachy/1.png" alt="Memory Wall"></p>
<p>ä¸€ä¸ªå¾ˆç®€å•è§£å†³æ€è·¯æ˜¯ï¼šè®©memoryç³»ç»Ÿå±‚æ¬¡åŒ–ã€‚é è¿‘CPUçš„æ•°æ®ï¼ˆå³å‡†å¤‡è¦ç”¨åˆ°çš„æ•°æ®ï¼‰ä½¿ç”¨è®¿é—®é€Ÿåº¦å¿«çš„å­˜å‚¨ç±»å‹å¦‚SRAMï¼Œç¨è¿œçš„åˆ™é‡‡ç”¨è®¿é—®é€Ÿåº¦æ…¢ä½†å®¹é‡å¤§çš„DRAMã€‚è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬æŠŠè®¡ç®—æœºæœ€å¸¸ç”¨çš„æŒ‡ä»¤(å¦‚loadï¼Œstrore)å’Œæ•°æ®é¢„å­˜åœ¨æ›´å°çš„memoryä¸­ï¼Œæˆ‘ä»¬ç§°å…¶ä¸ºcache æˆ–é«˜é€Ÿç¼“å­˜ã€‚å­˜å‚¨åœ¨cacheä¸­çš„æ•°æ®ï¼Œå¯ä»¥è¢«CPUå¿«é€Ÿè®¿é—®ã€‚</p>
<p>Noteï¼šcacheä¸­å¯ä»¥å­˜å‚¨æŒ‡ä»¤å’Œæ•°æ®ï¼Œåœ¨ä¹‹åçš„ä»‹ç»ä¸­ä»…æè¿°ä¸ºdataã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Memory%20Hierachy/2.png" alt="Memory Hierachy"></p>
<h2 id="5-1-2-Cache-è®¿é—®é€»è¾‘"><a href="#5-1-2-Cache-è®¿é—®é€»è¾‘" class="headerlink" title="5.1.2 Cache è®¿é—®é€»è¾‘"></a>5.1.2 Cache è®¿é—®é€»è¾‘</h2><p>å½“CPUéœ€è¦è®¿é—®å†…å­˜åœ°å€ï¼Œå³è¯»å¯¹åº”çš„æ•°æ®æ—¶ï¼Œé«˜é€Ÿç¼“å­˜çš„æ“ä½œå¦‚ä¸‹ï¼š</p>
<ol>
<li>å…ˆæ£€æŸ¥cacheä¸­æœ‰æ— åŒ¹é…çš„åœ°å€: cache line/entry </li>
<li>å‡å¦‚å†…å­˜çš„åœ°å€å¯ä»¥åœ¨cacheé‡Œæ‰¾åˆ°ï¼Œcacheåªéœ€è¦å°†æ•°æ®ä¼ å›ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸ºCache Hit</li>
<li>å‡å¦‚å†…å­˜åœ°å€ä¸åœ¨cacheä¸­æ‰¾åˆ°ï¼Œcacheå°±ä¼šåˆ†é…ä¸€ä¸ªcache lineç»™è¿™ä¸ªåœ°å€ï¼Œå¤„ç†å™¨éœ€è¦è®¿é—®main memoryï¼Œå¤„ç†å™¨å¾€å¾€éœ€è¦åœä¸‹æ¥ï¼ˆMicroprocessor stallï¼‰ç­‰åˆ°dataä»main memoryä¸­ä¼ å›ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸ºCache Missã€‚ä»¥æ­¤ç±»æ¨ï¼Œå½“Memory hierarchyæ›´å¤æ‚æ—¶ï¼Œä¹Ÿä¼šæœ‰Main Memory Hit/ Missã€‚</li>
</ol>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Memory%20Hierachy/3.png" alt="cacheè®¿é—®é€»è¾‘"></p>
<p>å½“CPUå¾€å†…å­˜å†™æ•°æ®æ—¶ï¼Œå³å†™å…¥å¯¹åº”æ•°æ®æ—¶ï¼Œé«˜é€Ÿç¼“å­˜çš„æ“ä½œå¦‚ä¸‹ï¼š</p>
<ol>
<li>ä¼šå…ˆæ£€æŸ¥cacheä¸­æœ‰æ— è¿™ä¸ªåœ°å€ï¼Œæœ‰åˆ™å†™å…¥æ•°æ®åˆ°å¯¹åº”çš„cacheä½ç½®ï¼›</li>
<li>å¦‚æœæ²¡æœ‰ï¼Œåˆ™æŒ‰ç…§æŸç§ï¼ˆpolicyï¼‰å¤„ç†ï¼Œè¿™ç‚¹åœ¨åè¾¹ç« èŠ‚5.3.3ç»†è¿°ã€‚</li>
</ol>
<h1 id="5-2-Memory-System-Performance-Analysis"><a href="#5-2-Memory-System-Performance-Analysis" class="headerlink" title="5.2 Memory System Performance Analysis"></a>5.2 Memory System Performance Analysis</h1><p>Miss Rate/ Hit Rateï¼šé‡è¦çš„æŒ‡æ ‡æ¥è¡¡é‡å­˜å‚¨å±‚æ¬¡çš„æ€§èƒ½ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Memory%20Hierachy/4.png" alt="Hit&amp;Miss rate"></p>
<p>Average memory access time AMAT:å¹³å‡å†…å­˜è®¿é—®æ—¶é—´ï¼š</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Memory%20Hierachy/5.png" alt="Average memory access time AMAT"></p>
<h1 id="5-3-Cache"><a href="#5-3-Cache" class="headerlink" title="5.3 Cache"></a>5.3 Cache</h1><p>ç´§æ¥ç€æ ¹æ®ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜æ¥è®¨è®ºcacheçš„è®¾è®¡ã€‚</p>
<p>ï¼ˆ1ï¼‰å…·ä½“ä»€ä¹ˆæ ·çš„dataéœ€è¦å­˜æ”¾åœ¨cacheï¼Ÿ</p>
<p>ï¼ˆ2ï¼‰dataå¦‚ä½•è¢«å¤„ç†å™¨å‘ç°ï¼Ÿ</p>
<p>ï¼ˆ3ï¼‰cacheä¸­çš„ä»€ä¹ˆæ•°æ®è¢«æ–°çš„æ•°æ®å–ä»£ï¼Œå½“cacheå†™æ»¡æ—¶ã€‚</p>
<h2 id="5-3-1-å…·ä½“ä»€ä¹ˆæ ·çš„dataéœ€è¦å­˜æ”¾åœ¨cacheï¼Ÿ"><a href="#5-3-1-å…·ä½“ä»€ä¹ˆæ ·çš„dataéœ€è¦å­˜æ”¾åœ¨cacheï¼Ÿ" class="headerlink" title="5.3.1 å…·ä½“ä»€ä¹ˆæ ·çš„dataéœ€è¦å­˜æ”¾åœ¨cacheï¼Ÿ"></a>5.3.1 å…·ä½“ä»€ä¹ˆæ ·çš„dataéœ€è¦å­˜æ”¾åœ¨cacheï¼Ÿ</h2><p>Cacheæ˜¯æ— æ³•èªæ˜åˆ°å¯ä»¥é¢„æµ‹æ¥ä¸‹æ¥å¤„ç†å™¨ä¼šç”¨åˆ°ä»€ä¹ˆæ•°æ®ï¼Œæ‰€ä»¥cacheåªèƒ½å»çŒœä»€ä¹ˆæ ·çš„æ•°æ®å¯èƒ½è¢«éœ€è¦ï¼Œ<strong>åŸºäºè¿‡å»memory access pattern</strong>ã€‚ç‰¹åˆ«åœ°ï¼Œcacheä½¿ç”¨çš„æ—¶é—´å±€åŸŸæ€§ï¼ˆTemporal localityï¼‰å’Œç©ºé—´å±€åŸŸæ€§ï¼ˆSpatial localityï¼‰ä»¥è·å¾—éå¸¸çš„ä½çš„miss rateã€‚</p>
<h3 id="5-3-1-1-è®¿å­˜çš„å±€åŸŸç‰¹æ€§"><a href="#5-3-1-1-è®¿å­˜çš„å±€åŸŸç‰¹æ€§" class="headerlink" title="5.3.1.1 è®¿å­˜çš„å±€åŸŸç‰¹æ€§"></a>5.3.1.1 è®¿å­˜çš„å±€åŸŸç‰¹æ€§</h3><p>å¤§å¤šæ•°ç¨‹åºå¹¶ä¸ä¼šåœ¨æ‰€æœ‰æ—¶åˆ»è®¿é—®æ•´ä¸ªå­˜å‚¨ç©ºé—´ï¼Œè®¿å­˜ä½ç½®å‡ºç°å±€åŸŸæ€§ç‰¹ç‚¹ã€‚</p>
<p><strong>A. æ—¶é—´å±€åŸŸæ€§ Temporal locality</strong> æŒ‡çš„æ˜¯å¤„ç†å™¨å¾ˆå¯èƒ½é©¬ä¸Šè®¿é—®æŸä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœæŸä¸€ä¸ªæ•°æ®è¢«è®¿é—®ã€‚å› æ­¤å½“å¤„ç†å™¨ä»Main memoryæ¬è¿ç‰¹å®šæ•°æ®åˆ°cacheä¸­ï¼Œè¿™ä¸ªç‰¹å®šæ•°æ®ç´§æ¥ç€å¸¸ç”¨çš„æ•°æ®ä¹Ÿè¢«æ¬è¿åˆ°cacheä¸­ã€‚</p>
<p>eg. è¿›å…¥ä¸€ä¸ªforå¾ªç¯ï¼Œforå†…çš„æ•°æ®æ¯”å¦‚i++ï¼Œæ•°æ®1å’ŒæŒ‡ä»¤â€+â€œä¼šè¢«åå¤ç”¨åˆ°ã€‚</p>
<p><strong>B. ç©ºé—´å±€åŸŸæ€§ Spatial locality</strong> æŒ‡çš„æ˜¯å¤„ç†å™¨è®¿é—®ä¸€ä¸ªmain memoryçš„æ•°æ®ä¹‹åï¼Œé‚£ä¸ªç‰¹å®šæ•°æ®æ‰€åœ¨memoryä½ç½®çš„å‘¨å›´çš„æ•°æ®å¾ˆæœ‰å¯èƒ½è¢«è®¿é—®ã€‚å› è€Œé™„è¿‘çš„æ•°æ®ä¹Ÿä¼šè¢«ä¸€èµ·æ¬è¿è¿›å…¥cacheä¸­ã€‚</p>
<p>eg. æ¯”å¦‚çŸ©é˜µä¹˜æ³•ï¼Œæ¯”å¦‚å›¾åƒè¾¹ç¼˜æå–ï¼Œé™„è¿‘çš„elementä¼šè¢«ä¸€èµ·è®¡ç®—ã€‚ </p>
<h3 id="5-3-1-2-cacheå­˜å‚¨çš„åŸºæœ¬å•ä½ï¼šBlock-Cache-line-Cache-entry"><a href="#5-3-1-2-cacheå­˜å‚¨çš„åŸºæœ¬å•ä½ï¼šBlock-Cache-line-Cache-entry" class="headerlink" title="5.3.1.2 cacheå­˜å‚¨çš„åŸºæœ¬å•ä½ï¼šBlock/Cache line/Cache entry"></a>5.3.1.2 cacheå­˜å‚¨çš„åŸºæœ¬å•ä½ï¼šBlock/Cache line/Cache entry</h3><p>é€šå¸¸å¤„ç†å™¨åªä¼šéœ€æ±‚ä¸€ä¸ªæŒ‡ä»¤ï¼ˆå¯¹äºMIPSç³»ç»Ÿåˆ™æ˜¯ä¸€ä¸ªwordï¼Œ32bitï¼‰ï¼Œä½†æ˜¯cacheçš„ä¸€ä¸ªå­˜å‚¨å•ä½Blockå¯ä»¥å®¹çº³ä¸æ­¢ä¸€ä¸ªwordã€‚å› è€Œå½“cacheå–ç‰¹å®šæŒ‡ä»¤ï¼ˆwordï¼‰æ—¶å€™ï¼Œå¾€å¾€è¿å¸¦å…¶ä»–æŒ‡ä»¤ï¼ˆwordï¼‰ä¸€èµ·å–å›ï¼Œå­˜åœ¨blockä¸­ã€‚</p>
<p>æ€»ç»“ä»¥ä¸‹ï¼Œcacheé€šå¸¸æœ‰ä»¥ä¸‹å‡ ä¸ªparameterå»æè¿°ï¼š</p>
<ol>
<li>å®¹é‡Capacity Cï¼šcacheä¸­èƒ½å­˜æœ‰wordsçš„æ•°é‡ã€‚</li>
<li>setï¼ˆentryï¼‰Sï¼šsetçš„æ•°é‡ã€‚</li>
<li>blockçš„å¤§å° bï¼šblock sizeï¼Œnumber of words it contains</li>
<li>blockçš„æ•°é‡ Bï¼šnumber of blocks</li>
<li>å…³è”åº¦ Nï¼šdegree of associativity</li>
</ol>
<h2 id="5-3-2-Dataå¦‚ä½•è¢«å¤„ç†å™¨å‘ç°ï¼Ÿ"><a href="#5-3-2-Dataå¦‚ä½•è¢«å¤„ç†å™¨å‘ç°ï¼Ÿ" class="headerlink" title="5.3.2 Dataå¦‚ä½•è¢«å¤„ç†å™¨å‘ç°ï¼Ÿ"></a>5.3.2 Dataå¦‚ä½•è¢«å¤„ç†å™¨å‘ç°ï¼Ÿ</h2><p>ç®€å•ä»‹ç»ä¸€ä¸ªcacheçš„ç‰©ç†ç»“æ„ï¼šä¸€ä¸ªcacheåˆ†å¸ƒåœ¨Sä¸ªsetä¸­ï¼Œï¼ˆsetå¯ä»¥ç²—ç•¥ç†è§£ä¸ºè¡Œrowï¼‰ï¼Œæ¯ä¸€ä¸ªsetä¸­å®¹çº³äº†ä¸€ä¸ªæˆ–è€…å¤šä¸ªblockï¼Œæ¯ä¸€ä¸ªblockå®¹çº³wordçš„æ•°é‡åˆ™å–å†³äºblock sizeï¼Œbã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Memory%20Hierachy/6.png" alt="Mapping"></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æˆ‘ä»¬éœ€è¦ä»Main memoryå–æ•°æ®æ”¾å…¥cacheä¸­æ—¶ï¼Œcacheçš„åœ°å€ä¸Main memoryåœ°å€æœ‰ä¸€ç§å¯¹åº”çš„ä½ç½®ï¼Œç§°ä¸ºmappingã€‚</p>
<p>ç‰¹åˆ«åœ°ï¼Œæ¯ä¸€ä¸ªMain memoryçš„åœ°å€ä»…ä»…å¯¹åº”åˆ°ä¸€ä¸ªcache setåœ°å€ã€‚å½“ä¸€ä¸ªcache setä¸­å«æœ‰å¤šä¸ªblockï¼Œåˆ™Main memoryä¸­æ•°æ®å¯ä»¥è¿›å…¥æŒ‡å®šsetä¸­çš„ä»»æ„ä¸€ä¸ªblockä¸­ã€‚æŒ‰ç…§ä¸€ä¸ªcache setä¸­çš„block çš„æ•°é‡ï¼Œå¯ä»¥æŠŠcacheåˆ†ä¸ºå‡ ç±»ã€‚</p>
<ol>
<li>Directed mapped cache:<br>æ¯ä¸€ä¸ªcache setåªå«æœ‰ä¸€ä¸ªblockï¼Œå› æ­¤cache setçš„æ•°é‡S=Bã€‚ä¸€ä¸ªMain memoryçš„åœ°å€å¯¹åº”åˆ°å”¯ä¸€çš„cache setä¸­å”¯ä¸€çš„blockä¸­ï¼Œæ²¡æœ‰å…¶ä»–blockå¯è¿›å…¥ã€‚</li>
<li>N-way set associative cache:<br>æ¯ä¸€ä¸ªcache setå«æœ‰Nä¸ªblockï¼Œå› æ­¤cache setçš„æ•°é‡ S=B/Nã€‚ä¸€ä¸ªMain memory çš„åœ°å€å¯¹åº”åˆ°å”¯ä¸€çš„cache setï¼Œä½†æ˜¯dataå¯ä»¥è¿›å…¥ç‰¹å®šset N blockä¸­ä»»æ„ä¸€ä¸ªblockä¸­ã€‚</li>
<li>A fully associative cache:<br>åªæœ‰ä¸€ä¸ªsetï¼ŒS=1ï¼ŒN=Bã€‚æ•°æ®å¯ä»¥è¿›å…¥ä¸€ä¸ªsetï¼ŒBä¸ªblockä¸­çš„ä»»æ„ä¸€ä¸ªã€‚</li>
</ol>
<p>ä¸‹é¢æŒ‰ç…§MIPSçš„memoryç³»ç»Ÿä¸ºä¾‹å­ä»‹ç»cacheä¸‰ç§æ¶æ„ã€‚MIPSæ˜¯ä¸€ä¸ª32ä½ç³»ç»Ÿï¼Œåœ°å€32ä½ä¸”byte-addressableï¼Œæ¯ä¸€ä¸ªåœ°å€åŒ…å«4ä¸ªbyteã€‚ä¸‹é¢æˆ‘ä»¬ä»¥cache capacity = C =8 words ä½œä¸ºä¾‹å­è®¨è®ºã€‚</p>
<h3 id="5-3-2-1-Direct-mapped-cache"><a href="#5-3-2-1-Direct-mapped-cache" class="headerlink" title="5.3.2.1 Direct mapped cache"></a>5.3.2.1 Direct mapped cache</h3><p>é¦–å…ˆéœ€è¦çŸ¥é“direct mapped cacheçš„mappingï¼Œå·¦è¾¹ä¸ºmain memory çš„åœ°å€ï¼Œå³è¾¹ä¸ºcacheçš„ç»“æ„ã€‚å³è¾¹cacheçš„ç»“æ„ä¸ºdirect mapped cacheï¼Œä¸€è¡Œæœ‰ä¸€ä¸ªblockï¼Œä¸€ä¸ªblockå­˜ä¸€ä¸ªwordã€‚å·¦è¾¹Main memoryæ¯ä¸ªaddresså­˜ä¸€ä¸ªbyteï¼Œ0x0-0x3ä½ç½®å­˜åœ¨Set0ï¼Œ0x4-0x7ä½ç½®å­˜åœ¨Set1ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°0x20-0x23ä½ç½®åˆå­˜å›Set0ä¸­ï¼Œä»¥æ­¤å¾ªç¯ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Memory%20Hierachy/7.png" alt="Mapping"></p>
<p>å›åˆ°5.3.2èŠ‚æˆ‘ä»¬éœ€è¦è®¨è®ºçš„ä¸œè¥¿ï¼Œå¦‚ä½•ä»cache addressæ‰¾åˆ°Main memoryçš„æ•°æ®ï¼Ÿè¿™å°±éœ€è¦çŸ¥é“Main memoryçš„åœ°å€å¦‚ä½•å¯¹åº”åˆ°cacheï¼Œè¿™ä¸memoryçš„åœ°å€ç›¸å…³ã€‚å¯¹äºåœ°å€å¦‚0xFFFFFFE4ï¼Œ32ä½å¯ä»¥åˆ†ä¸ºbyte offsetï¼Œindexï¼ˆset bitï¼‰ï¼Œtag bitç­‰ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Memory%20Hierachy/8.png" alt="Memory Adress ç»„æˆ"></p>
<p>Byte offsetï¼šä¸¤ä½è¡¨ç¤ºé€‰ä¸­cache lineçš„4ä¸ªbyteä¸­é€‰1ä¸ªbyteï¼›</p>
<p>Index/Set offsetï¼šè¡¨ç¤ºéœ€è¦é€‰ä¸­cache setçš„åœ°å€/è¡Œæ•°ï¼›</p>
<p>Tag bitï¼šå‰©ä¸‹çš„bitsåœ¨offsetå’Œset bitæ•°é‡è¢«å†³å®šï¼Œtag bitç”¨æ¥åŒºåˆ†memory&amp;cacheçš„mappingã€‚</p>
<p>tag bitçš„å†…å®¹ä¹Ÿå­˜åœ¨cacheä¸­ã€‚cacheä¸­å¯èƒ½è¿˜å­˜æœ‰Vï¼ˆvalidï¼‰å’ŒDï¼ˆDirtyï¼‰bitã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Memory%20Hierachy/9.png" alt="Cache line ç»„æˆ"></p>
<p>ä¸Šå›¾åˆ™è¡¨æ˜äº†mappingçš„ç»†èŠ‚ï¼Œset bité€‰ cache setï¼Œtag bitæ¯”è¾ƒï¼Œvalidæœ‰æ•ˆæ—¶ï¼Œç”Ÿæˆhitä¿¡å·ã€‚</p>
<p>Valid bitï¼šcache setç”¨è¿™ä¸ªvalid bitè¡¨æ˜è¿™ä¸ªsetä¿å­˜çš„dataæ˜¯å¦æ˜¯æœ‰æ•ˆçš„æ•°æ®ã€‚valid=1ï¼Œå†…å®¹æ˜¯æœ‰æ•ˆçš„ï¼›valid=0ï¼Œå†…å®¹æ˜¯æ— æ•ˆçš„ï¼›å½“ä¸¤ä¸ªæœ€è¿‘éœ€è¦è®¿é—®çš„åœ°å€mapåˆ°äº†åŒä¸€ä¸ªcache blockï¼Œè¿™å°±æ˜¯ä¸€ä¸ªconflictå‘ç”Ÿäº†ï¼Œæ‰€ä»¥æœ€è¿‘çš„åœ°å€ä¼šé©±é€å‰ä¸€ä¸ªåœ°å€ã€‚</p>
<p>æ€»ç»“è¿™ç§directed mappingçš„æ–¹å¼ï¼š</p>
<p>ä¼˜ç‚¹ï¼šè®¾è®¡ç®€å•ï¼Œé€ ä»·ä½ï¼Œæœç´¢é€Ÿåº¦å¿«ï¼ˆå‡ ä¹ä¸ç”¨æœç´¢ï¼‰ </p>
<p>ç¼ºç‚¹ï¼šå› ä¸ºåºå·indexçš„å…±äº«åº¦é«˜ï¼Œhit rateä½ã€‚</p>
<h3 id="5-3-2-2-Multi-way-set-associative-cache"><a href="#5-3-2-2-Multi-way-set-associative-cache" class="headerlink" title="5.3.2.2 Multi-way set associative cache"></a>5.3.2.2 Multi-way set associative cache</h3><p>N-way set associative cacheé€šè¿‡åœ¨ä¸€ä¸ªsetä¸­æä¾›N blocksï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘æ•°æ®çš„conflictã€‚Nå°±è¢«ç§°ä¸ºdegree of associativity ç›¸å…³åº¦ã€‚C=8 wordï¼ŒN=2 wayï¼ŒS=4 setã€‚å¯¹æ¯”ä¸Šé¢çš„cacheç»“æ„ï¼Œlog2(4)=2ï¼Œåˆ™éœ€è¦2ä¸ªè€Œä¸æ˜¯3ä¸ªselect bitã€‚tag bitåˆ™æ˜¯28 bitè€Œä¸æ˜¯27bitã€‚mappingçš„å¤–å›´ç”µè·¯åˆ™æ˜¯ç”¨åˆ°ä¸¤ä¸ªæ¯”è¾ƒå™¨ï¼Œä¸¤ä¸ªvalidä¿¡å·ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Memory%20Hierachy/10.png" alt="Multi-way set associative cache"></p>
<p>è¿™ç±»Set associative cache generllyæœ‰æ›´ä½çš„miss rateç›¸æ¯”äºdirect mapped cacheï¼ˆåœ¨ç›¸åŒçš„capacityçš„åŸºç¡€ä¸Šï¼‰å› ä¸ºä»–ä»¬æœ‰æ›´å°‘çš„conflictsã€‚ä½†æ˜¯è¿™ç±»set associativity cacheé€šå¸¸ä¼šæ›´æ…¢å’ŒæŸç§ç¨‹åº¦ä¸Šæ›´è´µå› ä¸ºéœ€è¦åœ¨output stageå»ºç«‹multiplexerå’Œé¢å¤–çš„æ¯”è¾ƒå™¨ã€‚</p>
<p>è¿˜å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šMulti-wayçš„cacheç»“æ„ä¸­ï¼Œæ¯ä¸€ä¸ªcache setä¼šæœ‰å¤šç»„tagå’Œvalid bitã€‚å› æ­¤å½“Næ•°é‡å¢åŠ æ—¶ï¼Œcacheå ç”¨çš„æ€»å­˜å‚¨é¢ç§¯æ˜¯ä¸Šå‡çš„ï¼ˆå®¹é‡Cä¸€å®šæƒ…å†µä¸‹ï¼‰ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„äº‹æƒ…æ˜¯ï¼Œåœ¨N-wayå·²ç»æ»¡äº†è€Œè¦å†™å…¥æ•°æ®æ—¶ï¼Œå“ªä¸€ä¸ªæ•°æ®éœ€è¦è¢«å–ä»£ã€‚è¿™ç‚¹å°†åœ¨5.3.3èŠ‚è®¨è®ºã€‚Set associative cacheå¸¸å¸¸è¢«ç”¨ä½œå•†ä¸šç”¨é€”ã€‚</p>
<h3 id="5-3-2-3-Fully-associative-cache"><a href="#5-3-2-3-Fully-associative-cache" class="headerlink" title="5.3.2.3 Fully associative cache"></a>5.3.2.3 Fully associative cache</h3><p>ä¸€ä¸ªFully associative cacheæ¶µç›–ä¸€ä¸ªsingle setï¼Œä½†æ˜¯æœ‰Bä¸ªwaysï¼ŒBæ˜¯blockæ•°é‡ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Memory%20Hierachy/11.png" alt="Fully associative cache"></p>
<p>è¿™ç§cacheç±»å‹ç›¸æ¯”äºä¸Šè¿°ä¸¤ç§ç±»å‹ï¼Œæœ‰ç€æœ€å°çš„conflict misses rateï¼ˆå½“cacheå®¹é‡ä¸€å®šæ—¶ï¼‰ç¼ºç‚¹ä¹Ÿæ˜æ˜¾ï¼Œä»–éœ€è¦æå…¶å¤šçš„ç¡¬ä»¶èµ„æºï¼Œsuch as tag bit comparators and mulitiplexersã€‚</p>
<h3 id="5-3-2-4-Consideration-Block-sizeï¼Œb"><a href="#5-3-2-4-Consideration-Block-sizeï¼Œb" class="headerlink" title="5.3.2.4 Consideration: Block sizeï¼Œb"></a>5.3.2.4 Consideration: Block sizeï¼Œb</h3><p>æˆ‘ä»¬å†è€ƒè™‘ä¸€ä¸ªé‡è¦çš„å‚æ•°ï¼Œblock sizeï¼Œä¸€ä¸ªblockä¸­å¯ä»¥å®¹çº³è¶…è¿‡ä¸€ä¸ªwordï¼Œè¶…è¿‡ä¸€ä¸ªwordé•¿åº¦ï¼Œå› æ­¤å¯ä»¥å……åˆ†åˆ©ç”¨åˆ°æ—¶é—´å±€åŸŸæ€§å’Œç©ºé—´å±€åŸŸæ€§ã€‚åœ¨ä¸€ä¸ªwordè¢«å–å…¥cache blockæ—¶ï¼Œç›¸é‚»çš„wordä¹Ÿè¢«ä¸€èµ·å­˜å…¥cache blockã€‚<strong>ä½†å¯¹äºmiss rateæ¥è¯´ï¼Œå¢åŠ block sizeçš„æ–¹æ³•å¹¶ä¸ä¸€å®šèƒ½å¤Ÿä¸€å®šå‡å°‘miss rateã€‚</strong>è¿™æ˜¯å› ä¸ºå½“cache å®¹é‡ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œå¢åŠ block sizeæ„å‘³ç€block setçš„æ•°é‡æ›´å°ï¼Œå•ä¸ªblock set mapåˆ°çš„memoryåœ°å€æ•°é‡æ›´å¤šï¼Œmiss rateè¿˜å¯èƒ½å¢åŠ ã€‚</p>
<p>é¢å¤–çš„ï¼Œè¿™å¢åŠ äº†ä¸€ä¸ªcache blockçš„å†™å…¥æ—¶é—´ï¼Œå› ä¸ºå†™å…¥çš„wordæ•°é‡å¢åŠ ã€‚å› æ­¤ä¸€æ—¦å‘ç”Ÿäº†missï¼Œä»main memoryè¿›è¡Œæ¬è¿æ—¶ï¼Œmiss penaltyä¼šéå¸¸å¤§ã€‚è‹¥æƒ³è¦é™ä½miss penalityåˆ™éœ€è¦è¿›ä¸€æ­¥å±‚æ¬¡åŒ–memoryï¼Œå¦‚ä½¿ç”¨å¤šçº§ç¼“å­˜ç»“æ„ã€‚</p>
<p>ç»“æ„ä¸Šéœ€è¦æ·»åŠ ï¼Œblock offsetè¿›è¡Œæ•°æ®çš„é€‰æ‹©ã€‚</p>
<p>ç°é˜¶æ®µï¼Œå•†ç”¨çš„cacheæ¶æ„è¿˜æ˜¯ä¼šé‡‡ç”¨å¤§çš„block sizeã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Memory%20Hierachy/12.png" alt="Block size çš„å½±å“"></p>
<p>æ€»ç»“ä¸€ä¸‹ä¸‰ç§cache typeï¼š</p>
<p>Increasing the associativity, N, usually reduces the miss rate caused by conflicts. But higher associativity requires more tag comparators. Increasing the block size, b, takes advantage of spatial locality to reduce the miss rate. However, it decreases the number of sets in a fixed sized cache and therefore could lead to more conflicts. It also increases the miss penalty.</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Memory%20Hierachy/13.png" alt="ä¸‰ç§cacheç±»å‹çš„æ€»ç»“"></p>
<h2 id="5-3-3-Cacheä¸­çš„ä»€ä¹ˆæ•°æ®è¢«æ–°çš„æ•°æ®å–ä»£"><a href="#5-3-3-Cacheä¸­çš„ä»€ä¹ˆæ•°æ®è¢«æ–°çš„æ•°æ®å–ä»£" class="headerlink" title="5.3.3 Cacheä¸­çš„ä»€ä¹ˆæ•°æ®è¢«æ–°çš„æ•°æ®å–ä»£?"></a>5.3.3 Cacheä¸­çš„ä»€ä¹ˆæ•°æ®è¢«æ–°çš„æ•°æ®å–ä»£?</h2><p>é¦–å…ˆå¼•å…¥ä¸€ä¸ªæ¦‚å¿µï¼šé«˜é€Ÿç¼“å­˜çš„ç¼ºå¤±ï¼Œå®ƒæŒ‡çš„æ˜¯æ‰€è®¿é—®çš„å†…å­˜åœ°å€è¿˜æ²¡æœ‰é¢„å–åˆ°cacheä¸­ã€‚å½“å‘ç”Ÿç¼ºå¤±æ—¶å€™ï¼Œåˆ™éœ€è¦è®²å†…å­˜çš„æ•°æ®å–å‡ºæ”¾å…¥cacheä¸­ï¼Œå½“cacheä¸­æœ‰æ•°æ®æ—¶ï¼Œå°±éœ€è¦è¿›è¡Œæ›¿æ¢ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Memory%20Hierachy/14.png" alt="ä¸‰ç§cacheç±»å‹çš„æ€»ç»“"></p>
<p>æ•°æ®çš„æ›¿æ¢ç­–ç•¥ä¸æ˜ å°„æ–¹å¼ç›¸å…³ï¼š</p>
<ol>
<li>å¯¹äºdirect mapped cacheæ¯ä¸€ä¸ªåœ°å€å¯¹åº”åˆ°å”¯ä¸€block setï¼Œæ‰€ä»¥è¿™ä¸ªblockä¸­å†…å®¹å°±æ˜¯victimï¼›</li>
<li>å¯¹äºN-way set associative cacheï¼Œå¦‚æœset is fullï¼Œåˆ™éœ€è¦æŒ‰ç…§ä¸€å®šçš„è§„åˆ™æ¥é©±é€ï¼ˆevitï¼‰ç‰¹å®šçš„blockï¼Œè¢«æ›¿æ¢çš„blockæˆä¸ºvictimã€‚</li>
<li>å¯¹äºfull associative cacheï¼Œå¦‚æœæ•´ä¸ªsetéƒ½æ»¡äº†ï¼Œå°±éœ€è¦æ›¿æ¢ã€‚</li>
</ol>
<p>ä»¥N-way set associative cacheä¸ºä¾‹ï¼Œæ›¿æ¢ç­–ç•¥æœ‰ï¼š</p>
<ol>
<li>è½®æ¢ç­–ç•¥ï¼šå…ˆå…¥å…ˆå‡ºï¼Œå°†ä¸€ç»„å„è·¯ä¹±æ¢ï¼Œç®—æ³•ç®€å•ï¼Œå…¨å±€åˆ©ç”¨æ•ˆç‡ä½ã€‚</li>
<li>LRUï¼ˆLeast recentyly usedï¼‰policyï¼šå¯¹å„è·¯è¿›è¡Œä½ç½®è¿›è¡Œæ’åºï¼Œæœ€å¸¸ç”¨çš„æ”¾åˆ°é˜Ÿåˆ—åº•ï¼›æœ€ä¸å¸¸ç”¨åˆ°çš„æ”¾åˆ°é˜Ÿåˆ—é¡¶è¢«æ›¿æ¢ã€‚</li>
<li>éšæœºç­–ç•¥ï¼šæœ€å®¹æ˜“å®ç°ã€‚</li>
</ol>
<p>æ•°æ®çš„æ›¿æ¢ç­–ç•¥ä¸æ˜ å°„æ–¹å¼ç›¸å…³ï¼š</p>
<ol>
<li>å¯¹äºdirect mapped cacheæ¯ä¸€ä¸ªåœ°å€å¯¹åº”åˆ°å”¯ä¸€block setï¼Œæ‰€ä»¥è¿™ä¸ªblockä¸­å†…å®¹å°±æ˜¯victimï¼›</li>
<li>å¯¹äºN-way set associative cacheï¼Œå¦‚æœset is fullï¼Œåˆ™éœ€è¦æŒ‰ç…§ä¸€å®šçš„è§„åˆ™æ¥é©±é€ï¼ˆevitï¼‰ç‰¹å®šçš„blockï¼Œè¢«æ›¿æ¢çš„blockæˆä¸ºvictimã€‚</li>
<li>å¯¹äºfull associative cacheï¼Œå¦‚æœæ•´ä¸ªsetéƒ½æ»¡äº†ï¼Œå°±éœ€è¦æ›¿æ¢ã€‚</li>
</ol>
<p>ä»¥N-way set associative cacheä¸ºä¾‹ï¼Œæ›¿æ¢ç­–ç•¥æœ‰ï¼š</p>
<ol>
<li>è½®æ¢ç­–ç•¥ï¼šå…ˆå…¥å…ˆå‡ºï¼Œå°†ä¸€ç»„å„è·¯ä¹±æ¢ï¼Œç®—æ³•ç®€å•ï¼Œå…¨å±€åˆ©ç”¨æ•ˆç‡ä½ã€‚</li>
<li>LRUï¼ˆLeast recentyly usedï¼‰policyï¼šå¯¹å„è·¯è¿›è¡Œä½ç½®è¿›è¡Œæ’åºï¼Œæœ€å¸¸ç”¨çš„æ”¾åˆ°é˜Ÿåˆ—åº•ï¼›æœ€ä¸å¸¸ç”¨åˆ°çš„æ”¾åˆ°é˜Ÿåˆ—é¡¶è¢«æ›¿æ¢ã€‚</li>
<li>éšæœºç­–ç•¥ï¼šæœ€å®¹æ˜“å®ç°ã€‚</li>
</ol>
<h2 id="5-3-4-Write-Policy"><a href="#5-3-4-Write-Policy" class="headerlink" title="5.3.4 Write Policy"></a>5.3.4 Write Policy</h2>]]></content>
      <categories>
        <category>Computer architecture</category>
      </categories>
      <tags>
        <tag>Computer architecture</tag>
      </tags>
  </entry>
  <entry>
    <title>Microarchitecture Part 1</title>
    <url>/2021/06/07/computer-architecture/microarchitecture-part-1/</url>
    <content><![CDATA[<p>Referenceï¼š</p>
<ol>
<li><em>Digital Design and Computer Architecture,</em> by David Harris, Sarah Harris</li>
<li><em>Introduction to Computing Systems</em>, by Yale N.Patt, Sanjay J. Patel</li>
</ol>
<h3 id="1-æ¶æ„çŠ¶æ€å’ŒæŒ‡ä»¤é›†"><a href="#1-æ¶æ„çŠ¶æ€å’ŒæŒ‡ä»¤é›†" class="headerlink" title="1. æ¶æ„çŠ¶æ€å’ŒæŒ‡ä»¤é›†"></a>1. æ¶æ„çŠ¶æ€å’ŒæŒ‡ä»¤é›†</h3><p>ä¸€ä¸ªè®¡ç®—æœºæ¶æ„æ˜¯ç”±å®ƒçš„æŒ‡ä»¤é›†(instruction set)å’Œæ¶æ„çŠ¶æ€(architectural stateï¼šThe architectural state is the part of the CPU which holds the state of a process. )ã€‚MIPSå¤„ç†å™¨çš„æ¶æ„çŠ¶æ€åŒ…å«ç¨‹åºè®¡æ•°å™¨å’Œ32ä¸ªå¯„å­˜å™¨ã€‚æŒ‡ä»¤é›†å†³å®šäº†å¾®æ¶æ„çš„ç¡¬ä»¶å±‚é¢çš„å¤æ‚ç¨‹åº¦ã€‚</p>
<h3 id="2-è®¾è®¡æµç¨‹"><a href="#2-è®¾è®¡æµç¨‹" class="headerlink" title="2. è®¾è®¡æµç¨‹"></a>2. è®¾è®¡æµç¨‹</h3><p>å¾®æ¶æ„å¯ä»¥åˆ†æˆä¸¤ä¸ªç›¸äº’ä½œç”¨çš„éƒ¨åˆ†ï¼šæ•°æ®é€šè·¯(datapath)å’Œæ§åˆ¶é€šè·¯(controlpath)ã€‚æ•°æ®é€šè·¯åŒ…æ‹¬äº†å†…å­˜ï¼Œå¯„å­˜å™¨ï¼ŒALUå’Œåˆ†è·¯é€‰æ‹©å™¨ã€‚æ§åˆ¶é€šè·¯åˆ™é€šè¿‡åˆ†è·¯é€‰æ‹©å™¨ï¼ˆMUXï¼‰è¿›è¡Œå¯„å­˜å™¨çš„enableæ§åˆ¶ï¼Œmemoryçš„è¯»å†™ä»¥æ§åˆ¶æ•°æ®é€šè·¯ã€‚</p>
<p>è®¾è®¡çš„è¿‡ç¨‹å¯ä»¥åˆ†æˆå‡ ä¸ªæ­¥éª¤ï¼š</p>
<p>Step 1: æ€è€ƒéœ€è¦çš„ç¡¬ä»¶éœ€è¦åŒ…å«å¤šå°‘çŠ¶æ€ï¼ˆå¤šå°‘çº§ï¼‰å­˜å‚¨å…ƒä»¶ã€‚</p>
<p>Step 2: åœ¨ä¸¤çº§çŠ¶æ€å•å…ƒä¹‹é—´æ’å…¥ç»„åˆé€»è¾‘ç”µè·¯ä»¥è®¡ç®—next stateã€‚</p>
<p>Step 3: é€šå¸¸ä¼šå°†æ¶æ„çš„memoryæ‹†æˆä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†å­˜å‚¨æŒ‡ä»¤ï¼Œå¦ä¸€éƒ¨åˆ†å­˜å‚¨æ•°æ®ã€‚</p>
<h4 id="2-1-Case-studyï¼šMIPS-Micropossessor"><a href="#2-1-Case-studyï¼šMIPS-Micropossessor" class="headerlink" title="2.1 Case studyï¼šMIPS Micropossessor"></a>2.1 Case studyï¼šMIPS Micropossessor</h4><p>å­˜å‚¨å…ƒä»¶ï¼šå­˜å‚¨å…ƒä»¶é€šå¸¸è¿˜éœ€è¦resetä¿¡å·ã€‚</p>
<p>Noteï¼š1. instruction memæ¨¡å—æ— clkï¼Œè¯´æ˜åªè¦åœ°å€Aæ”¹å˜ï¼ŒRDå°±ä¼šåœ¨ä¸€ä¸ªçŸ­æš‚çš„ç»„åˆé€»è¾‘delayåè¯»å‡ºæ–°çš„æŒ‡ä»¤ã€‚2. å…¶ä½™ä¸‰ä¸ªå­˜å‚¨å…ƒä»¶éƒ½æ˜¯åœ¨clkçš„èŠ‚æ‹ä¸‹è¿›è¡Œæ•°æ®åˆ·æ–°ï¼Œä»æ—¶åºçš„è§’åº¦ï¼ˆå¯„å­˜å™¨çš„è¦æ±‚ï¼‰ï¼Œåœ°å€å’Œæ•°æ®éœ€è¦åœ¨æ—¶é’Ÿä¸Šå‡æ²¿æ¥ä¹‹å‰ä¿æŒä¸€ä¸ªsetup timeï¼Œåœ¨æ—¶é’Ÿä¸Šå‡æ²¿æ¥ä¹‹åä¿æŒä¸€ä¸ªholding timeã€‚</p>
<p>The state of the system is changed only at the clock edge. The address, data, and write enable must setup sometime before the clock edge and must remain stable until a hold time after the clock edge.</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%201/1.png" alt="components"></p>
<h3 id="3-MIPS-æ¶æ„"><a href="#3-MIPS-æ¶æ„" class="headerlink" title="3  MIPS æ¶æ„"></a>3  MIPS æ¶æ„</h3><p>æˆ‘ä»¬æ¥ä¸‹æ¥ä¼šè®¨è®ºä¸‰ç§MIPSæ¶æ„ï¼šå•å‘¨æœŸï¼Œå¤šå‘¨æœŸå’Œæµæ°´çº¿çš„æ¶æ„ã€‚è¿™ä¸‰ç§ç»“æ„çš„ä¸åŒç‚¹åœ¨äºçŠ¶æ€å­˜å‚¨å•å…ƒçš„è¿æ¥å’Œéæ¶æ„çŠ¶æ€çš„æ•°é‡ä¸ç›¸åŒã€‚</p>
<ol>
<li><p>å•å‘¨æœŸå¾®å¤„ç†å™¨ï¼šå¤„ç†æ•´ä¸€ä¸ªæ•´ç†åœ¨ä¸€ä¸ªå‘¨æœŸã€‚</p>
<p> ç‰¹ç‚¹ï¼šæ§åˆ¶å•å…ƒç®€å•ï¼Œä¸éœ€è¦ä»»ä½•çš„éæ¶æ„çŠ¶æ€ã€‚ä½†å¾®å¤„ç†å™¨çš„å‘¨æœŸæ—¶é—´è¢«æœ€æ…¢çš„æŒ‡ä»¤æ‰€é™åˆ¶ã€‚</p>
</li>
<li><p>å¤šå‘¨æœŸå¾®å¤„ç†å™¨ï¼šå¤„ç†ä¸€æ¡æŒ‡ä»¤ç”¨ä¸€ç³»åˆ—çŸ­å‘¨æœŸã€‚ç®€å•çš„æŒ‡ä»¤ç›¸æ¯”äºå¤æ‚çš„æŒ‡ä»¤æ‰§è¡Œæ›´å°‘çš„å‘¨æœŸã€‚å¤šå‘¨æœŸçš„å¾®å¤„ç†å™¨é€šè¿‡é‡å¤ä½¿ç”¨æ˜‚è´µçš„ç¡¬ä»¶èµ„æºå¦‚åŠ æ³•å™¨å’Œå†…å­˜ï¼Œä»¥å‡å°‘ç¡¬ä»¶costã€‚ï¼ˆadderå¯èƒ½åœ¨å¤šä¸ªå‘¨æœŸä»¥ä¸åŒç”¨é€”è¢«è°ƒç”¨ï¼Œå¤šå‘¨æœŸå¾®å¤„ç†å™¨é€šè¿‡æ·»åŠ å‡ ä¸ªéæ¶æ„å¯„å­˜å™¨æ¥ä¿å­˜ä¸­é—´ç»“æœï¼‰ã€‚</p>
<p> å¤šå‘¨æœŸå¾®å¤„ç†å™¨ä¸€æ¬¡æŒ‡å¤„ç†ä¸€ä¸ªæŒ‡ä»¤ï¼Œä¸€ä¸ªæŒ‡ä»¤ä¼šèŠ±è´¹å¤šä¸ªæ—¶é’Ÿå‘¨æœŸã€‚</p>
</li>
<li><p>æµæ°´çº¿å¾®å¤„ç†å™¨ï¼šå°†æµæ°´çº¿åº”ç”¨åœ¨å•å‘¨æœŸå¾®å¤„ç†å™¨æ¶æ„ä¸Šã€‚</p>
<p> ç‰¹ç‚¹ï¼šå¯ä»¥åŒæ—¶å¤„ç†å¤šæ¡æŒ‡ä»¤ï¼Œæå¤§æé«˜ç³»ç»Ÿçš„ååé‡ã€‚æµæ°´çº¿åˆ™å¯¹æ§åˆ¶é€šè·¯çš„è¦æ±‚æ›´é«˜ï¼Œéœ€è¦æ˜‚è´µçš„é¢å¤–çš„MUXå’Œéæ¶æ„æµæ°´çº¿å¯„å­˜å™¨ã€‚</p>
</li>
</ol>
<h3 id="4-Perfomance-analysis"><a href="#4-Perfomance-analysis" class="headerlink" title="4 Perfomance analysis"></a>4 Perfomance analysis</h3><p>å¾®å¤„ç†å™¨çš„æ€§èƒ½ç”¨æ‰§è¡Œç‰¹ç‚¹ç¨‹åºï¼ˆæˆ–ç¨‹åºé›†ï¼‰æ‰€ä»¥èŠ±è´¹æ—¶é—´è€Œå®šã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%201/2.png" alt="execution time"></p>
<ol>
<li>instructions: å–å†³ä¸å¤„ç†å™¨æ¶æ„å’Œæ‰§è¡Œçš„ç¨‹åºçš„å†…å®¹ã€‚æŸäº›æ¶æ„ä¸‹æœ‰å¤æ‚çš„æŒ‡ä»¤å› è€Œåœ¨æ¯ä¸ªæŒ‡ä»¤å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ï¼Œä½†æ˜¯æœ‰ç§å¤æ‚çš„å¤„ç†å™¨æ¶æ„æ„å‘³ç€åœ¨ç¡¬ä»¶ä¸Šæ›´åŠ å¤æ‚ï¼Œå¾€å¾€æ‰§è¡Œå¾—æ›´æ…¢ã€‚ï¼ˆåœ¨æ­¤å¤„é»˜è®¤æ‰§è¡ŒåŒä¸€å¥—ç¨‹åºï¼‰</li>
<li>CPIï¼šä¸åŒçš„å¾®å¤„ç†å™¨æ¶æ„æœ‰ä¸åŒCPIsã€‚CPIä¸å¤„ç†å™¨æ¶æ„ï¼Œå­˜å‚¨å™¨æ¶æ„ç›¸å…³ã€‚å­˜å‚¨å™¨çš„æ¶æ„ä¼šå¯¹CPIäº§ç”Ÿæ˜¾è‘—çš„å½±å“ã€‚</li>
<li>Tcï¼šå¤„ç†å™¨èƒ½è¿è¡Œçš„æœ€é«˜é¢‘ç‡å–å†³äºå…³é”®è·¯å¾„ä¸Šçš„delayå’Œå¯„å­˜å™¨æ—¶åºè¦æ±‚ã€‚äº‹å®ä¸Šï¼Œç”±äºå·¥è‰ºèŠ‚ç‚¹çš„è¿›æ­¥ï¼Œå°½ç®¡å¾®æ¶æ„å’Œé€»è¾‘ä¸å˜å¤„ç†å™¨ä¹Ÿèƒ½è¿è¡Œåœ¨æ›´é«˜çš„é¢‘ç‡ä¸Šã€‚</li>
</ol>
]]></content>
      <categories>
        <category>Computer architecture</category>
        <category>Microarchitecture</category>
      </categories>
      <tags>
        <tag>Computer architecture</tag>
        <tag>Microarchitecture</tag>
      </tags>
  </entry>
  <entry>
    <title>Microarchitecture Part 3</title>
    <url>/2021/06/07/computer-architecture/microarchitecture-part-3/</url>
    <content><![CDATA[<p>Referenceï¼š</p>
<ol>
<li><em>Digital Design and Computer Architecture,</em> by David Harris, Sarah Harris</li>
<li><em>Introduction to Computing Systems</em>, by Yale N.Patt, Sanjay J. Patel</li>
</ol>
<h2 id="7-Pipeline-Processor-æµæ°´çº¿å¤„ç†å™¨"><a href="#7-Pipeline-Processor-æµæ°´çº¿å¤„ç†å™¨" class="headerlink" title="7. Pipeline Processor æµæ°´çº¿å¤„ç†å™¨"></a>7. Pipeline Processor æµæ°´çº¿å¤„ç†å™¨</h2><p>æµæ°´çº¿å¤„ç†å™¨å¯ä»¥é€šè¿‡åˆ†å‰²å•å‘¨æœŸå¤„ç†æˆäº”ä¸ªéƒ¨åˆ†ã€‚å› æ­¤æœ€é«˜å¯ä»¥æœ‰äº”æ¡æŒ‡ä»¤ä¸€èµ·æ‰§è¡Œã€‚æµæ°´çº¿å¯ä»¥æœ‰æ•ˆåœ°æé«˜ååé‡ã€‚</p>
<p>We design a pipelined processor by subdividing the single-cycle processor into five pipeline stages. Thus, five instructions can execute simultaneously, one in each stage.</p>
<p>æµæ°´çº¿ä»æ—¶é—´çš„è§’åº¦å……åˆ†åˆ©ç”¨äº†ç¡¬ä»¶èµ„æºã€‚<br><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%203/1.png" alt="æµæ°´çº¿æ—¶é—´è§’åº¦ä¸Šç¡¬ä»¶èµ„æº"></p>
<h3 id="7-1-Datapath-æ•°æ®é€šè·¯"><a href="#7-1-Datapath-æ•°æ®é€šè·¯" class="headerlink" title="7.1 Datapath æ•°æ®é€šè·¯"></a>7.1 Datapath æ•°æ®é€šè·¯</h3><p>è¯»å†™å†…å­˜å’Œå¯„å­˜å™¨ç»„å’Œä½¿ç”¨ALUé€šå¸¸æ˜¯å¤„ç†çš„æœ€å¤§delayçš„éƒ¨åˆ†ã€‚äº”çº§æµæ°´çº¿çš„æ¯ä¸€çº§éƒ½æ¶µç›–äº†ä¸€éƒ¨åˆ†è¿™äº›é«˜å»¶è¿Ÿéƒ¨åˆ†ã€‚å…·ä½“å¾—ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æˆå–æŒ‡IFï¼Œè¯‘ç DEï¼Œè¿ç®—EXï¼Œè¯»å†™å†…å­˜MEMï¼Œå†™å›WBäº”ä¸ªéƒ¨åˆ†ã€‚</p>
<p>Reading and writing the memory and register file and using the ALU typically constitute the biggest delays in the processor. We choose five pipeline stages so that each stage involves exactly one of these slow steps. Specifically, we call the five stages Fetch(IF), Decode(DE), Execute(EX), Memory(MEM), and Writeback(WB).</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%203/2.png" alt="é”™è¯¯5-stage"></p>
<p>ç®€å•å¾—å¢åŠ å‡ çº§regåœ¨ç»„åˆé€»è¾‘ç”µè·¯å’Œè¯»å†™å­˜å‚¨å•å…ƒä¹‹é—´ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œä¸Šå›¾ä¾¿æœ‰ä¸€å¤„é”™è¯¯ï¼å¯¹äºä¸€äº›æŒ‡ä»¤æ•°æ®/åœ°å€éœ€è¦æå‰åˆ°è¾¾ï¼Œä¼šæœ‰æ—¶åºä¸Šçš„é—®é¢˜</p>
<p>One of the subtle but critical issues in pipelining is that all signals associated with a particular instruction must advance through the pipeline in unison</p>
<p>é”™è¯¯åœ¨äºå¯„å­˜å™¨ç»„çš„å†™é€»è¾‘ä¸Šã€‚å¯„å­˜å™¨åœ¨æµæ°´çº¿ä¸­æ˜¯åœ¨DEä¸­è¯»å–æ•°æ®ï¼ŒWBä¸­å›å†™æ•°æ®ã€‚ç„¶è€Œåœ¨å›å†™çš„åœ°å€åœ¨DEå‡†å¤‡å¥½ï¼Œè€Œä¸æ˜¯WBã€‚</p>
<p>The error is in the register file write logic, The register file is peculiar because it is read in the Decode stage and written in the Writeback stage. And the correct address is already covered by other instructions when it comes to writeback stage.</p>
<p>è¿™ä¸ªé”™è¯¯å¯ä»¥ç®€å•é€šè¿‡ä¸‹å›¾ä¿®æ”¹ï¼Œå°†æ­£ç¡®çš„åœ°å€ä¸€èµ·ä¼ é€’åˆ°WBå†å†™å›ï¼Œå› æ­¤è¿™ä¸ªåœ°å€å’ŒWBå›å†™çš„æ•°æ®æ˜¯é€»è¾‘ä¸ŠåŒæ­¥çš„ã€‚</p>
<p>The WriteReg signal is now pipelined along through the Memory and Writeback stages, so it remains in sync with the rest of the instruction. WriteRegW and ResultW are fed back together to the register file in the Writeback stage.</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%203/3.png" alt="æ­£ç¡®5-stage"></p>
<p>äº‹å®ä¸Šï¼Œæµæ°´çº¿çš„è®¾è®¡å…³é”®éš¾ç‚¹åœ¨äºå¤„ç†hazardsï¼Œå¤„ç†æŒ‡ä»¤æ‰§è¡Œçš„é¡ºåºã€‚è¿™ä¸ªéƒ¨åˆ†ä¼šåœ¨ä¸‹é¢å•ç‹¬è®¨è®ºã€‚</p>
<p>A central challenge in pipelined systems is handling hazards that occur when the results of one instruction are needed by a subsequent instruction before the former instruction has completed. This section would be discussed sepearately later.</p>
<h3 id="7-2-Pipelined-Control-æµæ°´çº¿æ§åˆ¶"><a href="#7-2-Pipelined-Control-æµæ°´çº¿æ§åˆ¶" class="headerlink" title="7.2 Pipelined Control æµæ°´çº¿æ§åˆ¶"></a>7.2 Pipelined Control æµæ°´çº¿æ§åˆ¶</h3><p>é€šè¿‡å–æŒ‡åçš„opcodeå’Œfunctè¯‘ç æ§åˆ¶å­˜å‚¨çš„ä½¿èƒ½ä¿¡å·å’ŒMUXçš„é€‰é€šä¿¡å·ã€‚<br><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%203/4.png" alt="æ­£ç¡®5-stage"></p>
<h3 id="7-3-Hazard"><a href="#7-3-Hazard" class="headerlink" title="7.3 Hazard"></a>7.3 Hazard</h3><p>åœ¨æµæ°´çº¿ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªæŒ‡ä»¤åœ¨æ—¶é—´ä¸ŠåŒæ—¶è¢«æ‰§è¡Œã€‚å½“ä¸€æ¡æŒ‡ä»¤çš„çš„æ‰§è¡Œä¾èµ–äºå¦ä¸€æ¡æŒ‡ä»¤å®Œæˆçš„ç»“æœï¼Œåˆ™hazardå‘ç”Ÿã€‚</p>
<p>When one instruction is dependent on the results of another that has not yet completed, a hazard occurs.</p>
<p>RAW(Read after write) hazardï¼šä¸‹å›¾è¡¨ç¤ºhazardå‘ç”Ÿæµæ°´çº¿å†™å…¥å¯„å­˜å™¨ç»„ï¼Œå¦‚æœæ¥ä¸‹æ¥çš„ä¸¤æ¡æŒ‡ä»¤è¯»å–å¯„å­˜å™¨æ—¶</p>
<p>RAW(Read after write) hazardï¼šThe diagram shows that hazards may occur in this pipeline when an instruction writes a register and either of the two subsequent instructions read that register.<br><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%203/5.png" alt="hazard"></p>
<p>é€šå¸¸æ¥è¯´å¦‚æœé‡åˆ°RAW hazard æœ€ç›´ç™½çš„è§£å†³æ–¹æ³•å°±æ˜¯æµæ°´çº¿åœä¸‹æ¥ç­‰åˆ°hazardè§£å†³ã€‚ä»”ç»†è§‚å¯Ÿä¸Šè¿°æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼šAddåœ¨EXæ—¶å€™åœ¨ALUå·²ç»å®Œæˆäº†è®¡ç®—ï¼Œåœ¨MEMçº§ä¸éœ€è¦ä»»ä½•æ“ä½œã€‚ç©ºç­‰äº†ä¸€ä¸ªå‘¨æœŸæ‰WBã€‚å¯ä»¥é€šè¿‡æå‰å‘å‰ä¼ é€’ALUçš„ç»“æœæ¥æå‰WBï¼Œå‡å°‘æµæ°´çº¿æ”¾æ…¢çš„æ•ˆç‡ã€‚</p>
<p>On closer inspection, however, observe that the sum from the add instruction is computed by the ALU in cycle 3 and is not strictly needed by the and instruction until the ALU uses it in cycle 4. In principle, we should be able to forward the result from one instruction to the next to resolve the RAW hazard without slowing down the pipeline.</p>
<p>Hazards å¯ä»¥åˆ†æˆdata hazard å’Œ control hazardã€‚data hazard å‘ç”Ÿåœ¨æŒ‡ä»¤å°è¯•è¯»å–ä¸€ä¸ªå¯„å­˜å™¨ï¼Œä½†è¯¥å¯„å­˜å™¨è¿˜æœªè¢«å†™å›æ—¶ã€‚control hazard å‘ç”Ÿåœ¨å½“è·³è½¬æŒ‡ä»¤è¿˜æ²¡å†³å®šä¸‹ä¸€æ¡è¯¥è·³è½¬åˆ°é‚£ä¸€æ¡æŒ‡ä»¤æ—¶å€™ï¼Œå–æŒ‡å·²ç»å‘ç”Ÿã€‚</p>
<p>Hazards are classified as data hazards or control hazards. A data hazard occurs when an instruction tries to read a register that has not yet been written back by a previous instruction. A control hazard occurs when the decision of what instruction to fetch next has not been made by the time the fetch takes place.</p>
<p>A    Data Hazard</p>
<p>B)    Control Hazard</p>
<p>C)    Branch Hazard</p>
]]></content>
      <categories>
        <category>Computer architecture</category>
        <category>Microarchitecture</category>
      </categories>
      <tags>
        <tag>Computer architecture</tag>
        <tag>Microarchitecture</tag>
      </tags>
  </entry>
  <entry>
    <title>Microarchitecture Part 2</title>
    <url>/2021/06/07/computer-architecture/microarchitecture-part-2/</url>
    <content><![CDATA[<p>Referenceï¼š</p>
<ol>
<li><em>Digital Design and Computer Architecture,</em> by David Harris, Sarah Harris</li>
<li><em>Introduction to Computing Systems</em>, by Yale N.Patt, Sanjay J. Patel</li>
</ol>
<h2 id="5-Singlecycle-Processor-å•å‘¨æœŸå¤„ç†å™¨"><a href="#5-Singlecycle-Processor-å•å‘¨æœŸå¤„ç†å™¨" class="headerlink" title="5. Singlecycle Processor å•å‘¨æœŸå¤„ç†å™¨"></a>5. Singlecycle Processor å•å‘¨æœŸå¤„ç†å™¨</h2><p>é€šè¿‡è¿æ¥å­˜å‚¨å•å…ƒæ¥å»ºç«‹ç»„åˆé€»è¾‘ç”µè·¯çš„æ•°æ®é€šè·¯ã€‚æ§åˆ¶é€šè·¯ï¼ˆç»„åˆé€»è¾‘ç”µè·¯ï¼‰å¯ä»¥å†³å®šæ§åˆ¶ä¿¡å·ã€‚</p>
<p>Overview: We begin constructing the datapath by connecting the state elements with combinational logic that can execute the various instructions. Control signals determine which specific instruction is carried out by the datapath at any given time.</p>
<h3 id="5-1-Datapath-æ•°æ®é€šè·¯"><a href="#5-1-Datapath-æ•°æ®é€šè·¯" class="headerlink" title="5.1 Datapath æ•°æ®é€šè·¯"></a>5.1 Datapath æ•°æ®é€šè·¯</h3><h4 id="5-1-1-Step-1"><a href="#5-1-1-Step-1" class="headerlink" title="5.1.1 Step 1"></a>5.1.1 Step 1</h4><p>è¯»æŒ‡ä»¤ï¼šPC (Program counter) å¯„å­˜å™¨åŒ…å«éœ€è¦å¤„ç†çš„æŒ‡ä»¤åœ°å€ã€‚</p>
<p>The program counter (PC) register contains the address of the instruction to execute</p>
<p>ï¼ˆç°è‰²è¡¨ç¤ºå…ˆå‰è®¨è®ºè¿‡çš„state elementsï¼Œé»‘è‰²è¡¨ç¤ºæ•°æ®é€šè·¯ï¼‰</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%202/1.png" alt="PC"></p>
<p>å¤„ç†å™¨çš„å…·ä½“è¡Œä¸ºå–å†³äºå…·ä½“çš„å–å‡ºçš„æŒ‡ä»¤ï¼Œæˆ‘ä»¬å…ˆè€ƒè™‘lwæŒ‡ä»¤ã€‚</p>
<p>The processorâ€™s actions depend on the specific instruction that was fetched. First we will work out the datapath connections for the lw instruction.</p>
<h4 id="5-1-2-Step-2"><a href="#5-1-2-Step-2" class="headerlink" title="5.1.2 Step 2"></a>5.1.2 Step 2</h4><p>å¯¹äºlwæŒ‡ä»¤ï¼Œè¿™ä¸€æ­¥éœ€è¦åšçš„æ˜¯è¯»base address å’Œ offset addressã€‚baseåœ°å€å¯¹åº”æŒ‡ä»¤ä¸­rsçš„éƒ¨åˆ†ï¼Œå³ Instr25:21çš„éƒ¨åˆ†ã€‚offsetå¯¹åº”Instr15:0ã€‚</p>
<p>For a lw instruction, the next step is to read the source register containing the base address &amp; offset address. This register is specified in the rs field of the instruction, Instr25:21. The offset is stored in the immediate field of the instruction, Instr15:0.</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%202/2.png" alt="signæ‹“å±•"></p>
<p>ç”±äºåå…­ä½çš„åœ°å€å¯èƒ½æ˜¯æ­£æ•°æˆ–è€…è´Ÿæ•°ï¼Œå¿…é¡»è¦é€šè¿‡ç¬¦å·æ‹“å±•æˆ32ä½ã€‚</p>
<p>Because the 16-bit immedi- ate might be either positive or negative, it must be sign-extended to 32 bits</p>
<p>ç¬¦å·ä½æ‹“å±•å°±æ˜¯ç®€å•å¾—å°†MSBï¼ˆç¬¦å·ä½ï¼‰åœ¨é«˜ä½å¤åˆ¶æ‹“å±•ã€‚</p>
<p>sign extension simply copies the sign bit (most significant bit) of a short input into all of the upper bits of the longer output.</p>
<h4 id="5-1-3-Step-3"><a href="#5-1-3-Step-3" class="headerlink" title="5.1.3 Step 3"></a>5.1.3 Step 3</h4><p>-Combinational calculation ç»„åˆé€»è¾‘è®¡ç®—</p>
<p>å¤„ç†å™¨éœ€è¦å°†åŸºåœ°å€ï¼ˆä»å¯„å­˜å™¨ä¸­å–ï¼‰å’Œåç§»åœ°å€ï¼ˆæ‹“å±•åï¼‰ç›¸åŠ ã€‚ä¸¤è€…é€šè¿‡ä¸€ä¸ªä¸‰ä½ALUæ§åˆ¶ä¿¡å·çš„æ§åˆ¶ä¸‹ç›¸åŠ ï¼Œäº§ç”ŸALUresultå’Œzeroä¿¡å·ï¼ŒZero æ¥è¡¨ç¤ºç»“æœæ˜¯å¦ä¸º0ã€‚ALUç»“æœé€å…¥æ•°æ®å­˜å‚¨å™¨ä½œä¸ºloadæŒ‡ä»¤çš„æœ€ç»ˆåœ°å€ã€‚</p>
<p>The processor must add the base address to the offset to find the address to read from memory. The 3-bit <em>ALUControl</em> signal specifies the operation. The ALU generates a 32-bit <em>ALUResult</em> and a <em>Zero</em> flag, that indicates whether <em>ALUResult</em> is 0. ALUResult is sent to the data memory as the address for the load instruction</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%202/3.png" alt="ç»„åˆé€»è¾‘ç”µè·¯"></p>
<h4 id="5-1-4-Step-4"><a href="#5-1-4-Step-4" class="headerlink" title="5.1.4 Step 4"></a>5.1.4 Step 4</h4><ul>
<li>Mem reading / Mem è¯»å–</li>
</ul>
<p>ALUçš„ç»“æœä¼šä½œä¸ºData memoryçš„åœ°å€ï¼Œç»è¿‡ä¸€ä¸ªæ—¶é’ŸèŠ‚æ‹åæ•°æ®è¾“å‡ºåˆ° ReadData æ€»çº¿å†™å…¥ç›®æ ‡å¯„å­˜å™¨ä¸­ã€‚å…·ä½“ç›®æ ‡å¯„å­˜å™¨å¯¹åº”åœ°å€åœ¨æŒ‡ä»¤çš„rtéƒ¨åˆ†å³ Instr20:16çš„éƒ¨åˆ†ã€‚é»‘çº¿è¡¨ç¤ºçš„æ˜¯åœ°å€/æ•°æ®ã€‚</p>
<p>The data is read from the data memory onto the ReadData bus, then written back to the destination register in the register file at the end of the cycle. The destination register for the lw instruction is specified in the rt field, Instr20:16.</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%202/4.png" alt="Memè¯»å–"></p>
<h4 id="5-1-5-Step-5"><a href="#5-1-5-Step-5" class="headerlink" title="5.1.5 Step 5"></a>5.1.5 Step 5</h4><ul>
<li>Write Back å†™å›</li>
</ul>
<p>RegWriteè¿æ¥åœ¨ä½¿èƒ½ä¿¡å·ï¼Œæ•°æ®å’Œåœ°å€å’Œä½¿èƒ½ä¿¡å·å‡†å¤‡å¥½åï¼Œåœ¨ä¸‹ä¸€ä¸ªå‘¨æœŸCLKä¸Šå‡æ²¿æ—¶å€™å†™å…¥registerä¸­ã€‚ä¸Šå›¾è“è‰²éƒ¨åˆ†ã€‚</p>
<p>RegWrite is connected to the port 3 write enable input, WE3.The write takes place on the rising edge of the clock at the end of the cycle.</p>
<p>-Determine address of next instruction for PC //å–ä¸‹ä¸€æ¡æŒ‡ä»¤çš„PCåŠ æ³•</p>
<p>Instructions memæ˜¯byte accessableã€‚MIPSçš„32ä½æŒ‡ä»¤åŒ…å«4ä¸ªbyteã€‚å› è€Œå–ä¸‹ä¸€ä¸ªæŒ‡ä»¤æ—¶å€™éœ€è¦å°†PC+ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%202/5.png" alt="PCåŠ æ³•"></p>
<p>-Next, let us extend the datapath to also handle the sw instruction.æ¥ä¸‹æ¥æˆ‘ä»¬focusåœ¨sw(store word)æŒ‡ä»¤çš„æ•°æ®é€šè·¯</p>
<p>swä¹Ÿæ˜¯éœ€è¦åŸºåœ°å€+åç§»æ¥ç¡®å®šmemçš„åœ°å€ã€‚ä¸åŒç‚¹åœ¨äºswæ˜¯å†™å…¥memè€Œä¸æ˜¯è¯»å–memã€‚å› è€Œåœ¨ALUè®¡ç®—å‡ºmemåœ°å€åï¼Œå†™å…¥memçš„dataä¹Ÿéœ€è¦å‡†å¤‡å¥½ã€‚å› è€Œåœ¨å–åŸºåœ°å€æ—¶å€™ï¼Œä¹ŸåŒæ—¶å®Œæˆäº†ä»å¯„å­˜å™¨å–æ•°æ®ã€‚å¯„å­˜å™¨å¯¹åº”çš„åœ°å€åœ¨Instr20:16ã€‚ä½¿èƒ½ä¿¡å·ä¸ºMemWriteã€‚</p>
<p>the sw instruction reads a base address from port 1 of the register and sign-extends an immediate. The ALU adds the base address to the immediate to find the memory address. All of these func- tions are already supported by the datapath. The register is specified in the rt field, Instr20:16.  Enable signal is MemWrite.</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%202/6.png" alt="åœ°å€å†™å…¥"></p>
<p>-Next, consider extending the datapath to handle the R-type instructions æ¥ä¸‹æ¥æˆ‘ä»¬è€ƒè™‘æ‹“å±•æ•°æ®é€šè·¯åˆ°èƒ½å¤„ç†Rå‹æŒ‡ä»¤ã€‚</p>
<p>åŠ ï¼Œå‡ï¼Œæˆ–ï¼Œæ¯”è¾ƒã€‚è¿™äº›æŒ‡ä»¤éƒ½æ˜¯ä¼šç”¨åˆ°ä»å¯„å­˜å™¨ç»„ä¸­å–æ•°æ®å¹¶ä¸”åœ¨ALUä¸­è®¡ç®—æœ€åå†™å›åˆ°å¯„å­˜å™¨ç»„ä¸­ã€‚ä¸åŒåœ¨äºè¿›è¡Œçš„æ˜¯ä¸åŒALUæ“ä½œã€‚å› æ­¤åªéœ€è¦æ·»åŠ ä¸åŒçš„ALUç¡¬ä»¶èµ„æºï¼Œä½¿ç”¨ä¸åŒALUæ§åˆ¶ä¿¡å·ã€‚</p>
<p>Add, sub, and, or, and slt. All of these instructions read two registers from the register file, perform some ALU operation on them, and write the result back to a third register file. They differ only in the specific ALU operation. Hence, they can all be handled with the same hardware, using different ALUControl signals.</p>
<p>å¢åŠ MUXä½œä¸ºinputçš„é€‰æ‹©å¯ä»¥æœ‰æ•ˆå¢åŠ æ•°æ®é€šè·¯çš„å¤„ç†èƒ½åŠ›ã€‚</p>
<p>This principle of enhancing the datapathâ€™s capabilities by adding a multiplexer to choose inputs from several possibilities is extremely useful</p>
<p>å¦‚ä¸‹ï¼Œå¢åŠ ä¸‰ä¸ªMUXæ¥åŒºåˆ†æ˜¯lw&amp;swè¿˜æ˜¯R-typeæŒ‡ä»¤ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%202/7.png" alt="MUX&amp;WB"></p>
<p>branch è·³è½¬æŒ‡ä»¤</p>
<p>æ ¸å¿ƒï¼šå¢åŠ ä¸€ä¸ªMUXåšé€‰æ‹©ï¼ŒMUXçš„è¾“å…¥ä¸ºæ­£å¸¸å˜åŒ–çš„PCå’Œbranchåçš„PCï¼ŒALUè¿”å›æ˜¯å¦éœ€è¦è·³è½¬çš„é€‰æ‹©ä¿¡å·ã€‚<br><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%202/8.png" alt="åœ°å€åç§»é‡ç›¸åŠ è·å¾—æ–°åœ°å€"></p>
<h3 id="5-2-Control-path-æ§åˆ¶é€šè·¯"><a href="#5-2-Control-path-æ§åˆ¶é€šè·¯" class="headerlink" title="5.2 Control path æ§åˆ¶é€šè·¯"></a>5.2 Control path æ§åˆ¶é€šè·¯</h3><p>æ§åˆ¶ï¼ˆè¯‘ç ï¼‰éƒ¨åˆ†éœ€è¦åœ¨å–æŒ‡å®Œæˆä¹‹åï¼Œå¯¹æŒ‡ä»¤opcodeå’Œfunctï¼ˆR-typeçš„æŒ‡ä»¤çš„opcodeä¸º0ï¼‰è¿›è¡Œè¯‘ç ä»¥å†³å®šåé¢çš„æ•°æ®å¦‚ä½•æ‰§è¡Œã€‚å„ä¸ªå­˜å‚¨å…ƒä»¶çš„ä½¿èƒ½ä¿¡å·ï¼ŒMUXçš„é€‰é€šä¿¡å·éƒ½è¦åœ¨è¯‘ç æ§åˆ¶å•å…ƒçš„æ§åˆ¶ä¸‹æ‰§è¡Œã€‚ALUä½¿èƒ½çš„å®½åº¦ï¼ˆå›¾ä¸­æ˜¯ä¸‰ä½ï¼‰å¦‚æœéœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤é›†è¶Šå¤šï¼ŒALUä½¿èƒ½é€‰é€šä¿¡å·ä¼šæ›´åŠ å¤æ‚ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%202/9.png" alt="æ§åˆ¶é€šè·¯"></p>
<p>å¯¹äºæ¯ä¸€ä¸ªæŒ‡ä»¤ï¼Œæ§åˆ¶ä¿¡å·çš„çœŸå€¼è¡¨å¯ä»¥åˆ—å‡ºï¼š</p>
<p>ç”±äºswï¼Œbegä¸éœ€è¦å†™å›å› è€Œé€‰é€šä¿¡å·Xè¡¨ç¤ºdont careï¼Œæ–¹ä¾¿ç»„åˆé€»è¾‘ç”µè·¯çš„è®¾è®¡ï¼Œä½¿ç”¨*å¯ä»¥èŠ‚çœç»„åˆé€»è¾‘çš„é¢ç§¯å’Œè§„æ¨¡ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Computer%20architecture/Microarchitecture%20Part%202/10.png" alt="æ§åˆ¶ä¿¡å·çœŸå€¼è¡¨"></p>
<h3 id="5-3-Performance-evaluation-æ€§èƒ½çš„è€ƒé‡"><a href="#5-3-Performance-evaluation-æ€§èƒ½çš„è€ƒé‡" class="headerlink" title="5.3 Performance evaluation // æ€§èƒ½çš„è€ƒé‡"></a>5.3 Performance evaluation // æ€§èƒ½çš„è€ƒé‡</h3><p>ä¸€ä¸ªæ‰§è¡Œå‘¨æœŸåªæ‰§è¡Œä¸€ä¸ªå‘¨æœŸï¼Œå› æ­¤CPI=1ã€‚å…³é”®è·¯å¾„éœ€è¦è€ƒè™‘lw load wordå–æŒ‡åˆ°å†™å›æ•´ä¸ªæµç¨‹ã€‚</p>
<p>Each instruction in the single-cycle processor takes one clock cycle, so the CPI is 1. lw instruction provides the critical delay for accessing to the ALU, memory, and register file which are substantially slower than other operations.</p>
<h3 id="5-4-Comments"><a href="#5-4-Comments" class="headerlink" title="5.4 Comments"></a>5.4 Comments</h3><p>å•å‘¨æœŸå¾®æ§åˆ¶å™¨æœ‰ç€ä¸‰ä¸ªä¸»è¦çš„ç¼ºç‚¹ï¼š</p>
<p>The single-cycle processor has three primary weaknesses</p>
<ol>
<li><p>å®ƒè¦æ±‚çš„ä¸€ä¸ªå‘¨æœŸä»¥ç»´æŒæœ€æ…¢çš„ä¸€æ¡æŒ‡ä»¤lwè€Œå…¶ä»–çš„è´¨é‡éƒ½æ¯”å®ƒå¿«ã€‚</p>
<p> First, it requires a clock cycle long enough to support the slowest instruction (lw), even though most instructions are faster.</p>
</li>
<li><p>è¿‡ç¨‹ä¸­ç”¨åˆ°äº†ä¸‰ä¸ªåŠ æ³•å™¨ï¼šALUä¸­å’ŒPCä¸­ä¸¤ä¸ªï¼ŒåŠ æ³•å™¨åœ¨é¢ç§¯ä¸Šæ˜‚è´µï¼Œå°¤å…¶æ˜¯å¯¹äºé«˜é€ŸåŠ æ³•å™¨ã€‚</p>
<p> Second, it requires three adders (one in the ALU and two for the PC logic); adders are relatively expensive circuits, especially if they must be fast.</p>
</li>
<li><p>å®ƒå°†æŒ‡ä»¤å­˜å‚¨å™¨å’Œæ•°æ®å­˜å‚¨å™¨åˆ†ç¦»å¼€ã€‚</p>
<p> Third, it has sepa- rate instruction and data memories, which may not be realistic. Most computers have a single large memory that holds both instructions and data and that can be read and written.</p>
</li>
</ol>
<h2 id="6-Multicycle-Processor-å¤šå‘¨æœŸå¾®å¤„ç†å™¨"><a href="#6-Multicycle-Processor-å¤šå‘¨æœŸå¾®å¤„ç†å™¨" class="headerlink" title="6. Multicycle Processor å¤šå‘¨æœŸå¾®å¤„ç†å™¨"></a>6. Multicycle Processor å¤šå‘¨æœŸå¾®å¤„ç†å™¨</h2><p>å¤šå‘¨æœŸå¤„ç†è§£å†³ä¸Šè¿°çš„é—®é¢˜é€šè¿‡æŠŠæŒ‡ä»¤æ‹†æˆå‡ ä¸ªæ­¥éª¤ã€‚ä¸åŒçš„æŒ‡ä»¤æœ‰ä¸åŒæ•°é‡çš„æ­¥éª¤ï¼Œå¤æ‚çš„æŒ‡ä»¤æ­¥éª¤æ›´å¤šï¼Œå› è€Œéœ€è¦æ›´å¤šæ—¶é—´å®Œæˆã€‚</p>
<p>The multicycle processor addresses these weaknesses by breaking an instruction into multiple shorter steps. Different instructions use different numbers of steps, so simpler instructions can complete faster than more complex ones.</p>
]]></content>
      <categories>
        <category>Computer architecture</category>
        <category>Microarchitecture</category>
      </categories>
      <tags>
        <tag>Computer architecture</tag>
        <tag>Microarchitecture</tag>
      </tags>
  </entry>
  <entry>
    <title>Clock Domain Crossing (CDC) Part 1</title>
    <url>/2021/05/29/cdc/cdc-1/</url>
    <content><![CDATA[<p>Referenceï¼š</p>
<ol>
<li><p>ã€ŠThe Study of Synchronizer Design in Asynchronous Clock Domain Systemã€‹-è’²ç”°</p>
</li>
<li><p>ã€ŠClock Domain Crossing (CDC) Design &amp; Verification Techniques Using SystemVerilogã€‹-Clifford E. Cummings</p>
</li>
</ol>
<h3 id="1-Metastability"><a href="#1-Metastability" class="headerlink" title="1. Metastability:"></a>1. Metastability:</h3><p>äºšç¨³æ€æŒ‡ä¿¡å·åœ¨ä¸€æ®µæ—¶é—´å†…ä¸å†ç¨³å®šåœ¨0æˆ–è€…1ï¼ŒåŸå› åœ¨äºå­˜å‚¨å…ƒä»¶å¹¶éç†æƒ³å…ƒä»¶ï¼Œå¯¹äºå¯„å­˜å™¨ä¿¡å·éœ€è¦åœ¨æ—¶é’Ÿè¾¹æ²¿å‰åä¿æŒä¸å˜ï¼ˆsetup&amp;holdingçº¦æŸï¼‰ï¼Œå¦åˆ™å¯èƒ½äº§ç”Ÿä¸ç¨³å®šçš„è¾“å‡ºã€‚åœ¨å¤šæ—¶é’ŸåŸŸè®¾è®¡ä¸­ï¼Œäºšç¨³æ€ä¸èƒ½è¢«é¿å…ä½†æœ‰å®³æ•ˆåº”å¯ä»¥è¢«ä¸­å’ŒæŠµæ¶ˆã€‚</p>
<h4 id="1-1-Synchronization-failure"><a href="#1-1-Synchronization-failure" class="headerlink" title="1.1 Synchronization failure"></a>1.1 Synchronization failure</h4><p>ä¸‹å›¾å±•ç¤ºä¸¤çº§FFï¼Œä½†æ˜¯ä¸¤çº§çš„CLKä¸åŒæ­¥ï¼Œç¬¬äºŒçº§FFåœ¨ç¬¬ä¸€çº§è¾“å‡ºæœªè¾¾åˆ°ç¨³å®šæ—¶è¿›è¡Œäº†é‡‡æ ·ï¼Œäº§ç”Ÿsynchronization failure. å¦‚ä¸‹å›¾ï¼Œé‡‡æ ·ä¿¡å·æ— æ³•åœ¨bclkçš„ä¸‹ä¸€ä¸ªä¸Šå‡æ²¿ä¿æŒç¨³å®šï¼Œäºšç¨³æ€ä¼šè¢«ä¼ é€’ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_1/1.png" alt="åŒæ­¥é”™è¯¯"></p>
<p>â€œWhen sampling a changing data signal with a clock â€¦ the order of the events determines the outcome. The smaller the time difference between the events, the longer it takes to determine which came first. When two events occur very close together, the decision process can take longer than the time allotted, and a synchronization failure occurs.â€</p>
<h4 id="1-2-Consideration"><a href="#1-2-Consideration" class="headerlink" title="1.2 Consideration"></a>1.2 Consideration</h4><p>æ¯ä¸€çº§çš„FFéƒ½è¦ä¸€ä¸ªå…·ä½“çš„setup time å’Œ hold timeï¼Œå³è¦æ±‚inputçš„æ•°æ®åœ¨clock ä¸Šå‡æ²¿å‰ä¿æŒä¸€æ®µæ—¶é—´ï¼ˆsetupï¼‰å’Œä¹‹åä¿æŒä¸€æ®µæ—¶é—´ï¼ˆholdï¼‰ã€‚å¯¹äºä¸€ä¸ªå…·ä½“çš„è®¾è®¡è€Œè¨€ï¼Œè¿™ä¸ªæ—¶é—´çª—å£ï¼ˆäºšç¨³æ€çª—å£ï¼‰å¯ä»¥è§†ä¸ºä¸€ä¸ªdesign parameterï¼Œå½“è¿™ä¸ªæ—¶é—´çª—å£è¾“å…¥æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œè¾“å‡ºå°±å¯èƒ½äº§ç”Ÿäºšç¨³æ€ã€‚</p>
<h4 id="1-3-MTBF-Mean-Time-Before-Failure"><a href="#1-3-MTBF-Mean-Time-Before-Failure" class="headerlink" title="1.3 MTBF (Mean Time Before Failure)"></a>1.3 MTBF (Mean Time Before Failure)</h4><p>å¯¹äºå¤§å¤šæ•°åº”ç”¨ï¼Œå°¤å…¶æ˜¯è·¨æ—¶é’ŸåŸŸè®¡ç®—MTBFï¼ˆMean Time Before Failureï¼‰éå¸¸é‡è¦ã€‚FailureæŒ‡çš„æ˜¯ä¿¡å·é€šè¿‡é€šè¿‡ä¸€ä¸ªåŒæ­¥å¯„å­˜å™¨è¿›å…¥äºšç¨³æ€ï¼ŒæŒç»­ä¿æŒäºšç¨³æ€ç›´åˆ°è¢«ä¸‹ä¸€çº§å¯„å­˜å™¨é‡‡æ ·ã€‚MTBFè¡¨ç¤ºä¸¤ä¸ªfailureä¹‹é—´çš„æ—¶é—´ï¼ˆå¸Œæœ›å¤§åˆ°å‡ å¤©ï¼Œå‡ å¹´ï¼‰ã€‚</p>
<p>MTBFè¡¨ç¤ºè§¦å‘å™¨é‡‡æ ·å¤±è´¥çš„æ—¶é—´é—´éš”ã€‚MTBFçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼šMTBFçš„æ•°å€¼è¶Šå¤§è¶Šå¥½ï¼›å¤§MTBFè¡¨æ˜æ½œåœ¨å¤±æ•ˆå‘ç”Ÿåœ¨æ›´é•¿çš„æ—¶é—´èŒƒå›´å†…ï¼›å°çš„MTBFè¡¨æ˜äºšç¨³æ€æ›´å¯èƒ½å‘ç”Ÿã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_1/2.png" alt="MTBFç›¸å…³"></p>
<p>å®šé‡è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š<br><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_1/3.png" alt="MTBFå®šé‡è®¡ç®—å…¬å¼"><br>å…¶ä¸­ï¼š</p>
<ul>
<li>trÂ = åˆ†è¾¨æ—¶é—´ï¼ˆæ—¶é’Ÿæ²¿å¼€å§‹ï¼‰// resolution time (start from clk edge)</li>
<li>ğœ,ğ‘‡0Â = è§¦å‘å™¨å‚æ•° // parameters releated to FF</li>
<li>ğ‘“Â = é‡‡æ ·æ—¶é’Ÿé¢‘ç‡ // sampling frequency</li>
<li>a = å¼‚æ­¥äº‹ä»¶è§¦å‘é¢‘ç‡ // synchronized events activated frequency</li>
</ul>
<p>å¯¹äºä¸€ä¸ªå…¸å‹çš„ 0.25Âµm å·¥è‰ºçš„ ASIC åº“ä¸­çš„ä¸€ä¸ªè§¦å‘å™¨ï¼Œæˆ‘ä»¬å–å¦‚ä¸‹çš„å‚æ•°ï¼štr = 2.3ns, Ï„ = 0.31ns, T0 = 9.6as, f=100MHZ, a = 10MHZ, MTBF =Â <strong>2.01 days</strong></p>
<h4 id="1-4-Approaches-to-reduce-metastability"><a href="#1-4-Approaches-to-reduce-metastability" class="headerlink" title="1.4 Approaches to reduce metastability"></a>1.4 Approaches to reduce metastability</h4><p>ä»MTBFçš„è§’åº¦ï¼Œå‡å°‘äºšç¨³æ€çš„æ–¹æ³•æœ‰ä»¥ä¸‹å‡ ç§</p>
<ol>
<li><p>ä½¿ç”¨åŒæ­¥å™¨ï¼šä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„2çº§æˆ–è€…å¤šçº§FFæ‰“æ‹çš„æ–¹æ³•;åŒæ­¥å™¨åé¢ä¼šä¸“é—¨è®ºè¿°ï¼›</p>
</li>
<li><p>é™ä½é¢‘ç‡ï¼šå¦‚æœèƒ½æ»¡è¶³åŠŸèƒ½è¦æ±‚ï¼Œé‚£ä¹ˆé™ä½é¢‘ç‡èƒ½å¤Ÿå‡å°‘äºšç¨³æ€çš„äº§ç”Ÿ;</p>
</li>
<li><p>é¿å…å˜åŒ–è¿‡å¿«æˆ–è€…è¿‡äºé¢‘ç¹çš„ä¿¡å·è¿›è¡Œè·¨æ—¶é’Ÿé‡‡æ ·</p>
</li>
<li><p>é‡‡ç”¨æ›´å¿«çš„è§¦å‘å™¨ï¼šæ›´å¿«çš„è§¦å‘å™¨ï¼Œä¹Ÿå¯ä»¥å‡å°‘äºšç¨³æ€çš„äº§ç”Ÿã€‚</p>
</li>
</ol>
<h3 id="2-Synchronizers"><a href="#2-Synchronizers" class="headerlink" title="2. Synchronizers"></a>2. Synchronizers</h3><p>å½“ä¿¡å·è·¨æ—¶é’ŸåŸŸæ—¶å€™ï¼Œæœ€å®¹æ˜“å¿½è§†çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œè¿™ä¸ªä¿¡å·éœ€è¦æ¯ä¸ªæ—¶é’Ÿéƒ½è¢«é‡‡æ ·ï¼Œä¸èƒ½æ¼æ‰æ¯ä¸€ä¸ªå€¼å—ï¼Ÿè¿™æ˜¯æ–°æ‰‹æœ€å®¹æ˜“å¿½è§†çš„ä¸€ä¸ªé—®é¢˜ã€‚å½“è€ƒè™‘åˆ°ä¿¡å·ç©¿è¿‡CDCè¾¹ç•Œæ—¶ï¼Œ</p>
<p>æˆ‘ä»¬è€ƒè™‘ä¸¤ç§æƒ…å†µï¼š</p>
<ul>
<li>æœ‰ä¸€äº›ä¿¡å·ä¸éœ€è¦sample å¯ä»¥miss </li>
</ul>
<p>// some signals are not required to be sampled and could be missed.</p>
<ul>
<li>æ¯ä¸€ä¸ªä¿¡å·éƒ½éœ€è¦è¢«sample å¹¶ä¸”è·¨CDC </li>
</ul>
<p>// every signals are required to be sampled.</p>
<p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼šCDCä¿¡å·éƒ½éœ€è¦æŸç§å½¢å¼çš„åŒæ­¥åœ¨æ¥æ”¶æ—¶é’ŸåŸŸå†…<br>In both of these scenarios, the CDC signals will require some form of <strong>synchronization</strong> into the receiving clock domain.</p>
<p>åŒæ­¥å™¨ï¼šæ˜¯é‡‡æ ·ä¸€ä¸ªå¼‚æ­¥æ—¶é’Ÿä¿¡å·ï¼Œå¹¶å°†å…¶è¿‡æ¸¡æˆä¸ä¸€ä¸ªåœ¨æœ¬åœ°æˆ–è€…é‡‡æ ·æ—¶é’Ÿçš„è¾“å‡ºä¿¡å·ã€‚â€œA synchronizer is a device that samples an asynchronous signal and outputs a version of the signal that has transitions synchronized to a local or sample clockâ€</p>
<h4 id="2-1-Two-flip-flop-synchronizer"><a href="#2-1-Two-flip-flop-synchronizer" class="headerlink" title="2.1 Two flip-flop synchronizer"></a>2.1 Two flip-flop synchronizer</h4><p>æœ€ç®€å•å’Œæœ€å¸¸ç”¨çš„åŒæ­¥å™¨ï¼Œæ˜¯ä¸¤çº§FFåŒæ­¥å™¨.</p>
<p>ç¬¬ä¸€çº§FFé‡‡æ ·ä¸€ä¸ªå¼‚æ­¥ä¿¡å·ï¼Œæç«¯æƒ…å†µï¼ˆé‡‡æ ·ä¸€ä¸ªå˜åŒ–ä¿¡å·ï¼‰åˆ™ç¬¬ä¸€çº§FFè¾“å‡ºä¸ºäºšç¨³æ€ï¼›ä¿æŒä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸï¼ˆäºšç¨³æ€recoverï¼‰ï¼Œä¿¡å·è¢«é‡æ–°é‡‡æ ·ä¸ºæœ‰æ•ˆçš„è¾“å‡ºã€‚</p>
<p>Noteï¼šåŒå¯„å­˜å™¨å¹¶ä¸èƒ½æ¶ˆé™¤äºšç¨³æ€ï¼Œå®ƒåªæ˜¯å‡å°‘å‡ºç°äºšç¨³æ€çš„æ¦‚ç‡ï¼Œå‡å°‘åˆ°ä¸€ä¸ªå¯ä»¥å‡ ä¹å¿½ç•¥ä¸è®¡çš„ç¨‹åº¦ã€‚<br><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_1/4.png" alt="ä¸¤çº§åŒæ­¥å™¨"></p>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ï¼Œéœ€è¦ä¿è¯çš„è¿™ä¸ªä¿æŒæ—¶é—´ï¼Œå¦åˆ™ä¼šäº§ç”Ÿsynchronization failureã€‚ è¿™ä¸ªæ—¶é—´ä¸è¾“å…¥ä¿¡å·çš„é¢‘ç‡å’ŒåŒæ­¥FFçš„é¢‘ç‡æœ‰å…³ã€‚è¿™ä¸ªæ—¶é—´ä¸ºMTBFã€‚</p>
<p>å¯¹äºå¤§å¤šæ•°åŒæ­¥åº”ç”¨ï¼Œä¸¤çº§FFåŒæ­¥å™¨å·²ç»è¶³å¤Ÿç§»é™¤æ‰€æœ‰äºšç¨³æ€ã€‚</p>
<h4 id="2-3-Three-flip-flop-synchronizer"><a href="#2-3-Three-flip-flop-synchronizer" class="headerlink" title="2.3 Three flip-flop synchronizer"></a>2.3 Three flip-flop synchronizer</h4><p>å¯¹äºä¸€äº›æå…¶é«˜é€Ÿçš„åº”ç”¨ï¼ŒMTBFåœ¨ä¸¤çº§åŒæ­¥å™¨ä¹‹é—´å¤ªçŸ­ã€‚å› æ­¤å¯ä»¥æ·»åŠ ç¬¬ä¸‰çº§FFä»¥å¢åŠ MTBFåˆ°ä¸€ä¸ªæ»¡æ„çš„æ—¶é—´èŒƒå›´ã€‚<br><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_1/5.png" alt="ä¸‰çº§åŒæ­¥å™¨"></p>
]]></content>
      <categories>
        <category>VLSI</category>
        <category>CDC</category>
      </categories>
      <tags>
        <tag>VLSI</tag>
        <tag>CDC</tag>
      </tags>
  </entry>
  <entry>
    <title>Clock Domain Crossing (CDC) Part 2</title>
    <url>/2021/05/29/cdc/cdc-2/</url>
    <content><![CDATA[<p>Referenceï¼š<br>ã€ŠClock Domain Crossing (CDC) Design &amp; Verification Techniques Using SystemVerilogã€‹    -    Clifford E. Cummings</p>
<h3 id="2-4-Synchronizing-signals-requirements"><a href="#2-4-Synchronizing-signals-requirements" class="headerlink" title="2.4 Synchronizing signals requirements:"></a>2.4 Synchronizing signals requirements:</h3><h4 id="2-4-1-Requirment-for-sending-signals"><a href="#2-4-1-Requirment-for-sending-signals" class="headerlink" title="2.4.1 Requirment for sending signals"></a>2.4.1 Requirment for sending signals</h4><p>åœ¨å‘å°„æ—¶é’ŸåŸŸ&amp;æ¥å—æ—¶é’ŸåŸŸï¼Œå‘é€ä¿¡å·éœ€è¦è¢«registeredã€‚</p>
<p>å¯¹åŒæ­¥è¿‡ç¨‹å¾ˆå®¹æ˜“è¯¯è§£æˆï¼Œåªéœ€è¦æ¥å—æ—¶é’ŸåŸŸåŒæ­¥å³å¯ã€‚ä½†å¯¹äºå‘é€æ—¶é’ŸåŸŸï¼Œå¼‚æ­¥ä¿¡å·æ˜¯éœ€è¦æå‰å­˜åœ¨registerä¸­ï¼Œå³å‘é€åŸŸå¯„å­˜å™¨å’Œæ¥å—åŸŸå¯„å­˜å™¨ä¹‹é—´ä¸å†æœ‰ç»„åˆé€»è¾‘ç”µè·¯ã€‚è‹¥æœ‰ç»„åˆé€»è¾‘ç”µè·¯ï¼šæ¥å—åŸŸçš„è¾“å…¥ä¿¡å·adatä¼šç”±äºç»„åˆé€»è¾‘ç”µè·¯ä¸åŒè¾“å…¥å˜åŒ–å¸¦æ¥ä¸åŒæƒ…å†µçš„å»¶è¿Ÿå˜åŒ–ï¼Œé€»è¾‘å€¼ä¸åŒç­‰æƒ…å†µï¼Œè¿™å¢åŠ æ½œåœ¨æ¯›åˆºï¼ˆæˆ–æ˜¯éœ‡è¡ä¿¡å·ï¼‰çš„å¯èƒ½æ€§ï¼Œä¹Ÿå¢åŠ äº†äºšç¨³æ€çš„å¯èƒ½ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_2/1.png" alt="without registered"></p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_2/2.png" alt="with registered"></p>
<h4 id="2-4-2-requirement-for-reliability-of-signals"><a href="#2-4-2-requirement-for-reliability-of-signals" class="headerlink" title="2.4.2 requirement for reliability of signals"></a>2.4.2 requirement for reliability of signals</h4><p>å¯¹ä¿¡å·çš„å¯é æ€§çš„è¦æ±‚ã€‚ç”¨æ›´å¿«çš„æ—¶é’Ÿé‡‡æ ·æ…¢ä¿¡å·ï¼ˆé€šå¸¸æ˜¯1.5å€ä»¥ä¸Šç›¸è¾ƒäºæ…¢ä¿¡å·ï¼‰ï¼Œæ»¡ä¿¡å·ä¼šè¢«é‡‡æ ·ä¸€æ¬¡æˆ–è€…å¤šæ¬¡ï¼Œé€šå¸¸æ¥è¯´åŒæ­¥æ…¢ä¿¡å·ä¸ä¼šäº§ç”Ÿå¾ˆå¤šé—®é¢˜ã€‚ä½†æ…¢æ—¶é’Ÿé‡‡å¿«ä¿¡å·ä¼šå¸¦æ¥é—®é¢˜ã€‚</p>
<p>The â€œthree edgeâ€ requirementï¼šâ€input data values must be stable for three destination clock edgesâ€ è¾“å…¥æ•°æ®å€¼éœ€è¦åœ¨ä¸‰ä¸ªç›®æ ‡æ—¶é’Ÿæ²¿ä¿æŒç¨³å®šï¼Œå³1.5ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚</p>
<p>Problem A: Passing a fast CDC pulse</p>
<p>å½“CDCä¿¡å·åªæœ‰ä¸€ä¸ªå¿«æ—¶é’Ÿå‘¨æœŸçš„å®½åº¦ï¼Œé‚£ä¹ˆCDCä¿¡å·å¯èƒ½åœ¨ä¸¤ä¸ªæ…¢æ—¶é’Ÿçš„ä¸Šå‡æ²¿ä¹‹é—´å˜åŒ–ï¼Œå› è€Œæ¥å—æ—¶é’ŸåŸŸå¹¶æ²¡æœ‰é‡‡é›†åˆ°ä¿¡å·å˜åŒ–ã€‚<br><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_2/3.png" alt="ä¼ é€’ä¸€ä¸ªé«˜é€ŸCDCè„‰å†²"></p>
<p>Problem B: Sampling a long CDC pulse - but not long enough</p>
<p>å½“CDCä¿¡å·çš„å®½åº¦å¤§æ¦‚ç•¥å¤§äºä¸€ä¸ªæ…¢æ—¶é’Ÿå‘¨æœŸçš„å®½åº¦ï¼Œé‚£ä¹ˆCDCä¿¡å·åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹èƒ½é¡ºåˆ©é€šè¿‡ã€‚ä½†æ˜¯åœ¨ä¸‹å›¾éå¸¸ç½•è§çš„æƒ…å†µï¼Œadatæ°å¥½æ¨ªè·¨ä¸€ä¸ªæ…¢å‘¨æœŸçš„ä¸Šå‡æ²¿ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½è¿åç¬¬ä¸€ä¸ªå¯„å­˜å™¨çš„setup timeè¦æ±‚å’Œç¬¬äºŒä¸ªå¯„å­˜å™¨çš„hold timeè¦æ±‚ï¼Œè¾“å‡ºä¸ºäºšç¨³æ€ã€‚<br><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_2/4.png" alt="é‡‡æ ·ä¸€ä¸ªä¸å¤Ÿé•¿çš„CDCè„‰å†²"></p>
<p>å½“ä¸å…è®¸é‡‡æ ·è¿‡ç¨‹ä¸­ä¸¢å¤±é‡‡æ ·ç‚¹ï¼Œé€šå¸¸æ¥è¯´æœ‰ä¸¤ç§æ–¹æ³•æ¥è§£å†³ï¼š</p>
<ol>
<li>å¼€ç¯æ§åˆ¶ï¼šç”¨åŒæ­¥å™¨å¯¹ä¿¡å·è¿›è¡Œé‡‡æ ·ï¼š</li>
</ol>
<p>ä¿è¯CDCä¿¡å·å¤§æ¦‚åœ¨é‡‡æ ·æ—¶é’Ÿå‘¨æœŸåœ°1.5å€å·¦å³ï¼Œå¦‚æ­¤ä¿¡å·åœ¨ä¸€ä¸ªå‘¨æœŸä¸­ä¼šè¢«è‡³å°‘é‡‡æ ·ä¸€æ¬¡ã€‚</p>
<p>ä¼˜ç‚¹ï¼šå¼€ç¯åœ°æ§åˆ¶ä¿¡å·é•¿åº¦ï¼Œæœ€å¿«çš„å‘é€æ–¹å¼ï¼Œä¸éœ€è¦å‘é€ä¿¡å·è¿”å›çš„acknowlegmentã€‚</p>
<p>ç¼ºç‚¹ï¼šå½“å‚æ•°å˜åŒ–æ—¶å€™ï¼Œå·¥ç¨‹å¸ˆå¯èƒ½å¾ˆéš¾åœ¨å‘ç°è¿™ä¸ªé”™è¯¯ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡SVçš„æ–­è¨€æ¥åˆ¤æ–­ä¿¡å·æ˜¯å¦æ»¡è¶³äº†3edgeè¦æ±‚ã€‚<br>This problem can be minimized by adding a SystemVerilog Assertion to the model to detect if the input pulse ever fails to exceed the â€œthree edgesâ€ design requirement.</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_2/5.png" alt="å¼€ç¯æ§åˆ¶"></p>
<p>é—­ç¯æ§åˆ¶ï¼šä¿¡å·ç©¿è¿‡CDCåè¿”å›ä¸€ä¸ªacknowledgementåé¦ˆä¿¡å·ï¼Œè‡ªåŠ¨å»¶é•¿å¿«æ—¶é’ŸåŸŸçš„ä¿¡å·<br>åœ¨å‘å°„æ—¶é’ŸåŸŸæ·»åŠ ä¸€ä¸ªä½¿èƒ½ä¿¡å·ã€‚å½“æ¥å—æ—¶é’ŸåŸŸæ¥å—åˆ°ä¿¡å·åï¼Œé€šè¿‡ä¸€ä¸ªå‘å°„æ—¶é’ŸåŸŸçš„ä¸¤çº§åŒæ­¥å™¨äº§ç”Ÿacknowledgementä¿¡å·ï¼Œæ•°æ®å†ä»adatè¿›å…¥ï¼Œå¼€å§‹ä¼ å…¥ä¸‹ä¸€ä¸ªæ•°æ®ã€‚</p>
<p>ç¼ºç‚¹ï¼šæ•´ä¸ªè¿‡ç¨‹å»¶è¿Ÿè¿‡é•¿ï¼ˆä¸¤çº§åŒæ­¥å™¨ï¼‰</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_2/6.png" alt="é—­ç¯æ§åˆ¶"></p>
<h2 id="3-Multiple-signals-between-clock-domains"><a href="#3-Multiple-signals-between-clock-domains" class="headerlink" title="3. Multiple signals between clock domains"></a>3. Multiple signals between clock domains</h2><p>å½“ä¼ è¾“å¤šä½ä¿¡å·æ—¶ï¼Œç®€å•çš„åŒæ­¥å™¨å¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å®‰å…¨ä¼ è¾“ã€‚å¤šä½ä¿¡å·çš„ä¼ è¾“çš„é—®é¢˜åœ¨äºä¿¡å·åœ¨åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œæ•°æ®å˜åŒ–çš„åç§»ï¼ˆskewï¼‰ä¹Ÿå¯èƒ½è¢«ä¸åŒä¸Šå‡æ²¿é‡‡æ ·åˆ°ã€‚</p>
<p>ä¸ºäº†åº”å¯¹å¤šä½CDCåç§»é‡‡æ ·çš„æƒ…å†µï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>å°½å¯èƒ½è®©å¤šä½çš„CDCä¿¡å·åˆæˆå•bitCDCä¿¡å·</li>
<li>Multi-cycle path formulation. ä½¿ç”¨åŒæ­¥ä¿¡å·æ¥ä¿è¯CDCä¿¡å·èƒ½é€šè¿‡</li>
<li>ä½¿ç”¨Gray code</li>
</ul>
<h3 id="3-1-æ§åˆ¶ä¿¡å·å¤šæ¯”ç‰¹çš„åŒæ­¥"><a href="#3-1-æ§åˆ¶ä¿¡å·å¤šæ¯”ç‰¹çš„åŒæ­¥" class="headerlink" title="3.1 æ§åˆ¶ä¿¡å·å¤šæ¯”ç‰¹çš„åŒæ­¥"></a>3.1 æ§åˆ¶ä¿¡å·å¤šæ¯”ç‰¹çš„åŒæ­¥</h3><h4 id="Problem-1ï¼šå¤šä¸ªæ§åˆ¶ä¿¡å·ä¹‹é—´ä¼ è¾“åç§»"><a href="#Problem-1ï¼šå¤šä¸ªæ§åˆ¶ä¿¡å·ä¹‹é—´ä¼ è¾“åç§»" class="headerlink" title="Problem 1ï¼šå¤šä¸ªæ§åˆ¶ä¿¡å·ä¹‹é—´ä¼ è¾“åç§»"></a>Problem 1ï¼šå¤šä¸ªæ§åˆ¶ä¿¡å·ä¹‹é—´ä¼ è¾“åç§»</h4><p>ä¾‹å¦‚ä¸‹é¢ä¾‹å­ï¼Œå½“loadä¿¡å·å’Œenä¿¡å·åŒæ—¶åœ¨æ¥æ”¶æ—¶é’ŸåŸŸæ‹‰é«˜ï¼Œaq_load å’Œ aq_enæ‰èƒ½åŒæ—¶è¢«ä¼ è¾“ï¼Œæ‰èƒ½å®ç°loadçš„æ“ä½œã€‚å› è€Œæ§åˆ¶ä¿¡å·çš„skewå¯ä»¥å¯¼è‡´ä¸¤ä¸ªæ§åˆ¶ä¿¡å·çš„ä¼ è¾“ä¸åŒæ­¥ï¼Œä»Šå„¿å¯¼è‡´åç»­æ¥æ”¶æ—¶é’ŸåŸŸçš„æ§åˆ¶ä¿¡å·ä¸åŒæ­¥ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_2/7.png" alt="å¤šä¸ªæ§åˆ¶ä¿¡å·"></p>
<h4 id="Solution-1ï¼šåˆå¹¶"><a href="#Solution-1ï¼šåˆå¹¶" class="headerlink" title="Solution 1ï¼šåˆå¹¶"></a>Solution 1ï¼šåˆå¹¶</h4><p>å°†ä¸¤ä¸ªæ§åˆ¶ä¿¡å·åˆå¹¶æˆä¸€ä¸ªï¼Œæ§åˆ¶ä¿¡å·ä¹‹é—´å°±ä¸å­˜åœ¨åŒæ­¥é—®é¢˜ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_2/8.png" alt="åˆå¹¶"></p>
<h4 id="Problem-2-å¤šä¸ªæ§åˆ¶ä¿¡å·ä¹‹é—´å­˜åœ¨æ—¶é’Ÿç›¸ä½å·®"><a href="#Problem-2-å¤šä¸ªæ§åˆ¶ä¿¡å·ä¹‹é—´å­˜åœ¨æ—¶é’Ÿç›¸ä½å·®" class="headerlink" title="Problem 2: å¤šä¸ªæ§åˆ¶ä¿¡å·ä¹‹é—´å­˜åœ¨æ—¶é’Ÿç›¸ä½å·®"></a>Problem 2: å¤šä¸ªæ§åˆ¶ä¿¡å·ä¹‹é—´å­˜åœ¨æ—¶é’Ÿç›¸ä½å·®</h4><p>å¦‚æœä¸¤ä¸ªæ§åˆ¶ä¿¡å·æœ¬èº«å­˜åœ¨ä¸€å®šçš„æ—¶é’Ÿç›¸ä½å·®ï¼Œä»¥æ»¡è¶³ä¸€äº›é€»è¾‘æˆ–è€…æ•°æ®ä¼ è¾“çš„æ—¶åºè¦æ±‚ï¼Œé‚£ä¹ˆåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ï¼ˆæˆ–è€…è¯´åœ¨æ¥æ”¶æ—¶é’ŸåŸŸä¸­ï¼‰ï¼Œå¯èƒ½æ§åˆ¶ä¿¡å·æœªè¢«é‡‡é›†åˆ°ã€‚å› è€Œå¯¼è‡´æ•°æ®é€šè·¯å‡ºé—®é¢˜</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_2/9.png" alt="æ—¶é’Ÿç›¸ä½å·®"></p>
<h4 id="Solution-2ï¼šåœ¨æ¥å—åŸŸå†…äº§ç”Ÿæ§åˆ¶ä¿¡å·"><a href="#Solution-2ï¼šåœ¨æ¥å—åŸŸå†…äº§ç”Ÿæ§åˆ¶ä¿¡å·" class="headerlink" title="Solution 2ï¼šåœ¨æ¥å—åŸŸå†…äº§ç”Ÿæ§åˆ¶ä¿¡å·"></a>Solution 2ï¼šåœ¨æ¥å—åŸŸå†…äº§ç”Ÿæ§åˆ¶ä¿¡å·</h4><p>æ”¹è¿›æ–¹æ³•ï¼šåªä¼ è¾“ä¸€ä¸ªä¿¡å·ï¼Œå¦ä¸€ä¸ªä¿¡å·åœ¨åŒæ­¥æ—¶é’ŸåŸŸä¸­äº§ç”Ÿã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_2/10.png" alt="æ¥å—åŸŸäº§ç”Ÿæ§åˆ¶ä¿¡å·"></p>
<h3 id="3-2-æ•°æ®ä¿¡å·å¤šæ¯”ç‰¹çš„åŒæ­¥"><a href="#3-2-æ•°æ®ä¿¡å·å¤šæ¯”ç‰¹çš„åŒæ­¥" class="headerlink" title="3.2 æ•°æ®ä¿¡å·å¤šæ¯”ç‰¹çš„åŒæ­¥"></a>3.2 æ•°æ®ä¿¡å·å¤šæ¯”ç‰¹çš„åŒæ­¥</h3><p>æ•°æ®å¤šä½æ•°æ®çš„ä¼ è¾“å¯¹ä½é—´åç§»æ•æ„Ÿã€‚ä¸‹é¢ä¾‹å­å±•ç¤ºäº†ç¼–ç ä¿¡å·ä¼ æ’­åˆ°æ¥æ”¶æ—¶é’ŸåŸŸï¼Œè‹¥åç§»å­˜åœ¨ï¼Œå¯èƒ½å¯¼è‡´æ¥å—æ—¶é’ŸåŸŸäº§ç”Ÿå®Œå…¨é”™è¯¯çš„ç»“æœã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/CDC/CDC_2/11.png" alt="æ¥å—åŸŸäº§ç”Ÿæ§åˆ¶ä¿¡å·"></p>
<p>è§£å†³æ•°æ®åŒæ­¥æ–¹æ³•ä¸»è¦æœ‰ä¸¤ç§ </p>
<ol>
<li>Multi-cycle path formulation å¤šå‘¨æœŸè·¯å¾„è§„åˆ’    </li>
<li>FIFO</li>
</ol>
]]></content>
      <categories>
        <category>VLSI</category>
        <category>CDC</category>
      </categories>
      <tags>
        <tag>VLSI</tag>
        <tag>CDC</tag>
      </tags>
  </entry>
  <entry>
    <title>Clock Domain Crossing (CDC) Part 3</title>
    <url>/2021/05/29/cdc/cdc-3/</url>
    <content><![CDATA[<p>Check</p>
]]></content>
      <categories>
        <category>VLSI</category>
        <category>CDC</category>
      </categories>
      <tags>
        <tag>VLSI</tag>
        <tag>CDC</tag>
      </tags>
  </entry>
  <entry>
    <title>DFT 1. Fault_model &amp; Failure_mechanisms</title>
    <url>/2021/05/29/design-for-testability/dft-1-fault-type/</url>
    <content><![CDATA[<ol>
<li>Core concept: Stuck-at-fault (SAT)</li>
</ol>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/DFT/1.fault_model%20%26%20failure_mechanisoms/1.png" alt="fault sites"></p>
<p>Notes: </p>
<p><strong>Mutiple SAT:</strong><br><strong>Multiple stuck-at faults are usually not considered in practice because of two reasons</strong></p>
<p><strong>â€“ The number of multiple stuck-at faults in a circuit with k lines is 3^k-1, which is too large a number even for circuits of moderate size</strong></p>
<p>â€“ <strong>Tests for single stuck-at faults are known to cover a very high percentage (greater than 99.6%) of multiple stuck-at faults when the circuit is large and has several outputs</strong></p>
<ol start="2">
<li>Stuck-open fault model (SOpF)</li>
</ol>
<p>Testing: need a sequential test vectors (tesing the transient from connect to disconnect)</p>
<ol start="3">
<li>Stuck-on fault model (SOnF): might contribute a directed path from vdd to ground.</li>
</ol>
<p>Testing: Iddq test, test the current whether is surficiently large.</p>
<ol start="4">
<li><p>Geometrical Fault Model: Bridging Faults (BFs) , get shorted for example.</p>
</li>
<li><p>Pattern-sensitive fault: changed by neightbor values. (DRAM)</p>
</li>
<li><p>Coupling fault: Between Cells (Victim and Aggressor)</p>
</li>
<li><p>Delay fault model: slow to propagate a 1 to 0 for example.</p>
</li>
<li><p>Crosstalk defects: </p>
</li>
</ol>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/DFT/1.fault_model%20%26%20failure_mechanisoms/2.png" alt="Crosstalk defects"></p>
<p>source from: tow parasitc capacitance between two signal nets.</p>
]]></content>
      <categories>
        <category>VLSI</category>
        <category>CDC</category>
      </categories>
      <tags>
        <tag>VLSI</tag>
        <tag>CDC</tag>
      </tags>
  </entry>
  <entry>
    <title>Efficient FSM coding in verilog</title>
    <url>/2021/04/05/fsm-coding/notes-fsm-coding/</url>
    <content><![CDATA[<p>Learning Source:ã€ŠThe Fundamentals of Efficient Synthesizable Finite State Machine Design using NC-Verilog and BuildGatesã€‹</p>
<h3 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract:"></a>Abstract:</h3><ol>
<li>Important techniques related to one and two always block styles to code FSMs with combinational outputs are given to show why using a two always block style is preferred. </li>
<li>An efficient Verilog-unique onehot FSM coding style is also shown. </li>
<li>Reasons and techniques for registering FSM outputs are also detailed.</li>
</ol>
<h3 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction:"></a>1. Introduction:</h3><h4 id="Note-åˆ©ç”¨Alwaysè¯­å¥ç¼–å†™ç»„åˆé€»è¾‘ç”µè·¯å’Œæ—¶åºé€»è¾‘ç”µè·¯ã€‚"><a href="#Note-åˆ©ç”¨Alwaysè¯­å¥ç¼–å†™ç»„åˆé€»è¾‘ç”µè·¯å’Œæ—¶åºé€»è¾‘ç”µè·¯ã€‚" class="headerlink" title="Note: åˆ©ç”¨Alwaysè¯­å¥ç¼–å†™ç»„åˆé€»è¾‘ç”µè·¯å’Œæ—¶åºé€»è¾‘ç”µè·¯ã€‚"></a>Note: åˆ©ç”¨Alwaysè¯­å¥ç¼–å†™ç»„åˆé€»è¾‘ç”µè·¯å’Œæ—¶åºé€»è¾‘ç”µè·¯ã€‚</h4><ol>
<li><p>ç»„åˆé€»è¾‘ç”µè·¯çš„always blockç¼–å†™ä¸¥æ ¼ï¼ˆé˜»å¡èµ‹å€¼ï¼‰ï¼Œæ•æ„Ÿåˆ—è¡¨å†…æ²¡æœ‰posedge or negedgeè¿™äº›verilog keywordï¼</p>
<blockquote>
<p>Combinational always blocks are always blocks that are used to code combinational logic functionality and are strictly coded using blocking assignmentsã€‚</p>
</blockquote>
</li>
<li><p>æ—¶åºç”µè·¯always blockï¼ˆéé˜»å¡èµ‹å€¼ï¼‰ï¼Œæœ‰edge-based sensitivity listã€‚</p>
</li>
</ol>
<h3 id="2-Mearly-and-moore-FSM"><a href="#2-Mearly-and-moore-FSM" class="headerlink" title="2. Mearly and moore FSM"></a>2. Mearly and moore FSM</h3><p><img src="https://github.com/XuLixing/blog_images/raw/main/Learning_Notes/FSM/images/1.%20FSM%E7%B1%BB%E5%9E%8B.png" alt="Figure 1.FSM_type"></p>
<h3 id="3-Binary-or-Onehot-Encoded"><a href="#3-Binary-or-Onehot-Encoded" class="headerlink" title="3. Binary or Onehot Encoded?"></a>3. Binary or Onehot Encoded?</h3><ul>
<li><p>Binary-encode FSM éœ€è¦çš„ä½å®½ï¼ˆFFçš„æ•°é‡ï¼‰ä»…æ˜¯éœ€è¦çŠ¶æ€çš„log2ï¼ˆ#statesï¼‰</p>
<p>  ä¼˜ç‚¹ï¼šä½¿ç”¨è§¦å‘å™¨çš„ä¸ªæ•°è¾ƒå°‘ï¼ŒèŠ‚çœèµ„æºã€‚<br>  ç¼ºç‚¹ï¼šçŠ¶æ€è·³è½¬æ—¶å¯èƒ½æœ‰å¤šä¸ªbité”™è¯¯ï¼Œå¼•èµ·æ¯›åˆºï¼Œé€ æˆé€»è¾‘é”™è¯¯ã€‚</p>
</li>
<li><p>One-hot encode FSM éœ€è¦çš„ä½å®½ï¼ˆFFçš„æ•°é‡ï¼‰ä¸ºéœ€è¦çš„çŠ¶æ€çš„æ•°é‡ã€‚</p>
<p>  ç¼ºç‚¹ï¼šå¢åŠ äº†è§¦å‘å™¨ä¸ªæ•°ï¼Œå¯„å­˜å™¨èµ„æºåˆ©ç”¨æ•ˆç‡ä½ã€‚<br>  ä¼˜ç‚¹ï¼šä½†æ˜¯æ–¹ä¾¿è¯‘ç ï¼Œæœ‰æ•ˆåŒ–ç®€ç»„åˆé€»è¾‘ç”µè·¯</p>
</li>
</ul>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Learning_Notes/FSM/images/2.%20code%20style.png" alt="Figure 2.ç¼–ç æ–¹å¼"></p>
<p>Notesï¼š</p>
<ol>
<li><p>FPGAæ¨èä½¿ç”¨one-hotç¼–ç å› ä¸ºå…¶å†…ç½®æœ‰è¶³å¤Ÿæ•°é‡çš„FFï¼Œä½¿ç”¨one-hotç¼–ç å¯ä»¥èŠ‚çœå¤æ‚çš„è¯‘ç ç»„åˆé€»è¾‘ç”µè·¯è®¾è®¡ã€‚</p>
<blockquote>
<p>FPGA vendors frequently recommend using a onehot state encoding style because flip-flops are plentiful in an FPGA and the combinational logic required to implement a onehot FSM design is typically smaller than most binary encoding styles.</p>
</blockquote>
</li>
<li><p>FPGAçš„æ€§èƒ½ä¸FPGAä¸­ç»„åˆé€»è¾‘ç”µè·¯çš„sizeçš„å†³å®šã€‚å®ç°åŒæ ·çš„åŠŸèƒ½ï¼Œonehotç çš„ç”¨åˆ°çš„ç»„åˆé€»è¾‘ç”µè·¯é¢ç§¯æ›´å°ï¼Œå¯ä»¥run fasterã€‚</p>
<blockquote>
<p>Since FPGA performance is typically related to the combinational logic size of the FPGA design, onehot FSMs typically run faster than a binary encoded FSM with larger combinational logic blocks</p>
</blockquote>
</li>
</ol>
<h3 id="4-FSM-Coding-Goalsï¼š"><a href="#4-FSM-Coding-Goalsï¼š" class="headerlink" title="4. FSM Coding Goalsï¼š"></a>4. FSM Coding Goalsï¼š</h3><ul>
<li>The FSM coding style should be easily modified to change state encodings and FSM styles.</li>
<li>The coding style should be compact.</li>
<li>The coding style should be easy to code and understand.</li>
<li>The coding style should facilitate debugging.</li>
<li>The coding style should yield efficient synthesis results.</li>
</ul>
<h3 id="5-Two-Always-Block-FSM-style-Good"><a href="#5-Two-Always-Block-FSM-style-Good" class="headerlink" title="5. Two Always Block FSM style (Good)"></a>5. Two Always Block FSM style (Good)</h3><h4 id="5-1-Exapmle-Code"><a href="#5-1-Exapmle-Code" class="headerlink" title="5.1 Exapmle_Code"></a>5.1 Exapmle_Code</h4><p>ç”¨ä¸¤ä¸ªalways blockç¼–å†™ï¼Œä¸€ä¸ªå†™æ—¶åºé€»è¾‘ï¼Œä¸€ä¸ªå†™ç»„åˆé€»è¾‘ã€‚</p>
<p>Noteï¼š</p>
<ol>
<li>æ—¶åºalways blockå®šä¹‰æ—¶åºç”µè·¯ï¼ˆçŠ¶æ€è½¬ç§»ï¼‰ï¼Œéé˜»å¡èµ‹å€¼ã€‚</li>
<li>ç»„åˆalways blockå®šä¹‰ç»„åˆé€»è¾‘ç”µè·¯ï¼Œæ•æ„Ÿåˆ—è¡¨ä¸ºè¾“å…¥ï¼Œæ²¡æœ‰æ—¶é’Ÿclkå’Œå¤ä½ä¿¡å·ï¼Œä½¿ç”¨é˜»å¡èµ‹å€¼ã€‚</li>
</ol>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Learning_Notes/FSM/images/3.4states_FSM.png" alt="Figure 3.Four-states FSM"></p>
<p>Important notes:</p>
<ol>
<li><p>Parameter å®šä¹‰stateç±»å‹ï¼ˆbinaryè¿˜æ˜¯onehotï¼‰å’Œåç§°ï¼ˆstateçš„åå­—ï¼‰ï¼šæ–¹ä¾¿ä¿®æ”¹ï¼Œå¦‚æœéœ€è¦æ¢coding styleçš„è¯å°±åªéœ€è¦æ›´æ”¹parameterçš„å®šä¹‰å°±è¡Œã€‚</p>
</li>
<li><p>åœ¨è¾“å‡ºèµ‹å€¼ä¹‹åï¼Œå†ç»™state or next stateèµ‹å€¼ã€‚</p>
<blockquote>
<p>Declarations are made for state and next (next state) after the parameter assignments.</p>
</blockquote>
</li>
<li><p>æ—¶åºé€»è¾‘ç”¨éé˜»å¡èµ‹å€¼ã€‚</p>
<blockquote>
<p>The sequential always block is coded using nonblocking assignments.</p>
</blockquote>
</li>
<li><p>ç»„åˆé€»è¾‘ç”µè·¯çš„æ•æ„Ÿåˆ—è¡¨æœ‰stateï¼Œæ‰€æœ‰ç»„åˆé€»è¾‘inputå˜é‡ã€‚</p>
</li>
<li><p>ç»„åˆé€»è¾‘ç”µè·¯always blockä¸­ç”¨é˜»å¡èµ‹å€¼ã€‚</p>
</li>
<li><p><strong>The combinational always block has a default next state assignment at the top of the always block</strong></p>
</li>
<li><p>è¾“å‡ºåœ¨caseè¯­å¥å‰è¢«èµ‹åˆå€¼ï¼ˆdefault valueï¼‰ã€‚ä¼˜ç‚¹åœ¨äºï¼š</p>
<p> A. caseè¯­å¥ä¹‹åä¸éœ€è¦å†å†™defaultçš„æƒ…å†µï¼Œç”µè·¯ä¸Šæ¶ˆé™¤äº†äº§ç”Ÿé”å­˜å™¨çš„å¯èƒ½ã€‚<br> B. æ¯ä¸€ä¸ªcaseä¸­åªåœ¨è¾“å‡ºå˜åŒ–èµ‹æ–°çš„å€¼ã€‚ä»ä»£ç ä¸Šï¼Œæ›´å®¹æ˜“è§‚å¯Ÿåˆ°è¾“å‡ºçš„å˜åŒ–ï¼Œä»£ç å¯è¯»æ€§å¢åŠ ã€‚</p>
<blockquote>
<p>Default output assignments are made before coding the <strong>case</strong> statement (this eliminates latches and reduces the amount of code required to code the rest of the outputs in the <strong>case</strong> statement and highlights in the <strong>case</strong> statement exactly in which states the individual output(s) change)</p>
</blockquote>
</li>
<li><p>ç»„åˆé€»è¾‘always blockå†…çš„if-else è¯­å¥æ•°é‡å’Œ çŠ¶æ€è½¬ç§»å›¾STDçš„è½¬ç§»å¼§çº¿æ•°é‡ä¸€è‡´ã€‚ï¼ˆè¾“å…¥çš„ !rstä¸ç®—ï¼‰</p>
<blockquote>
<p>The number of transition arcs between states in the FSM state diagram should equal the number of <strong>if</strong>-<strong>else</strong>-type statements in the combinational always block.</p>
</blockquote>
</li>
<li><p>æ–¹ä¾¿æŸ¥çœ‹ï¼Œnextçš„èµ‹å€¼éƒ½æ”¾åœ¨åŒä¸€åˆ—ã€‚</p>
</li>
</ol>
<h4 id="5-2-Fear-of-transitions-to-erroneous-states"><a href="#5-2-Fear-of-transitions-to-erroneous-states" class="headerlink" title="5.2 Fear of transitions to erroneous states"></a>5.2 Fear of transitions to erroneous states</h4><p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸ä¼šå‘ç”Ÿã€‚</p>
<p>åœ¨ä¸€äº›æç«¯æƒ…å†µä¸‹ï¼Œç³»ç»Ÿè¦æ±‚æ›´é«˜çš„robertnessï¼šå¦‚alphaç²’å­ï¼Œé«˜èƒ½ç²’å­ç­‰ã€‚ç³»ç»Ÿçš„çŠ¶æ€å¯èƒ½è¿›å…¥åˆ°ä¸€ä¸ªé”™è¯¯çŠ¶æ€ï¼ä½†æ˜¯è®©state/next stateå¯„å­˜å™¨å›åˆ°æƒ³è¦çš„çŠ¶æ€å¹¶ä¸å¤Ÿï¼è¿™æ˜¯å› ä¸ºå¯èƒ½ï¼Œå‰©ä¸‹éƒ¨åˆ†çš„ç¡¬ä»¶å·²ç»è¿›å…¥å˜åŒ–åçš„stateçš„çŠ¶æ€ã€‚</p>
<p>Possible bad situationï¼šç³»ç»Ÿå¯èƒ½å› æ­¤è¿›å…¥ä¸€ä¸ªlockupçŠ¶æ€ï¼Œå› ä¸ºç¡¬ä»¶æ­£åœ¨ç­‰å¾…ä¸€ä¸ªä¸å¯èƒ½åˆ°æ¥çš„çŠ¶æ€è½¬ç§»ä¿¡å·ã€‚ï¼ˆå¦‚ç³»ç»Ÿåœ¨å¯åŠ¨åï¼Œç”±äºé«˜èƒ½ç²’å­è½°å‡»ï¼Œåˆšå¥½å›åˆ°å¯åŠ¨stateï¼Œä½†æ˜¯å¤–ç•Œä¸ä¼šå†ç»™å¯åŠ¨çš„æ¿€åŠ±ï¼Œå› è€Œç³»ç»Ÿä¼šå¡åœ¨æ­¤çŠ¶æ€ä¸åŠ¨ï¼‰</p>
<p>è§£å†³åŠæ³•ï¼šéœ€è¦ä¸€ç§è®¾è®¡ï¼Œå½“stateå¯„å­˜å™¨è¿›å…¥åˆ°é”™è¯¯çŠ¶æ€æ—¶ï¼šä¸ä»…ä¸‹ä¸€ä¸ªæ—¶åˆ»ï¼Œstateèƒ½è‡ªåŠ¨å›åˆ°æ­£å¸¸çŠ¶æ€ï¼Œå‰©ä¸‹çš„çŠ¶æ€ä¹Ÿä¼šåœ¨ä¸‹ä¸€ä¸ªçŠ¶æ€è¿‡æ¸¡æ—¶å€™resetï¼</p>
<h4 id="5-3-Making-default-next-equal-all-Xâ€™s-assignment"><a href="#5-3-Making-default-next-equal-all-Xâ€™s-assignment" class="headerlink" title="5.3 Making default next equal all Xâ€™s assignment"></a>5.3 Making default next equal all Xâ€™s assignment</h4><p>åœ¨ç»„åˆé€»è¾‘alwaysæ•æ„Ÿåˆ—è¡¨åï¼Œç›´æ¥å¯¹nextè¿›è¡Œèµ‹åˆå€¼Xâ€˜sï¼Œnextä¼šåœ¨ä¹‹åçš„caseä¸­è¢«èµ‹åˆå€¼ã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Learning_Notes/FSM/images/3.4states_FSM.png" alt="Figure 4.Four-states FSM"></p>
<p>å¦‚æœæˆ‘ä»¬ç»™å…¨Xç»™nextï¼Œå¦‚æœæŸä¸€çŠ¶æ€è½¬ç§»å¯èƒ½æ²¡æœ‰åœ¨caseè¯­å¥ä¸­è¢«æè¿°åˆ°ï¼Œstateçš„é¢„ç»¼åˆä»¿çœŸæ¨¡å‹ä¼šäº§ç”Ÿä¸€ä¸ªæœªçŸ¥çš„è¾“å‡ºçš„çŠ¶æ€ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆdebug FSMè®¾è®¡çš„æ–¹æ³•ã€‚Xåœ¨ç»¼åˆå·¥å…·é‡Œè®¤ä¸ºæ˜¯donâ€™t care. </p>
<blockquote>
<p>By making a default next state assignment of Xâ€™s, pre-synthesis simulation models will cause the state machine outputs to go unknown if not all state transitions have been explicitly assigned in the case statement. This is a useful technique to debug state machine designs, plus the Xâ€™s will be treated as â€œdonâ€™t caresâ€ by the synthesis tool.</p>
</blockquote>
<p><strong>ä¸ç†è§£çš„é—®é¢˜ï¼šå¦‚æœç»„åˆé€»è¾‘è¿‡äºå¤æ‚ï¼Ÿï¼Ÿï¼Ÿï¼Ÿå¦‚pcpu</strong></p>
<h3 id="6-One-Always-Block-FSM-style-Avoid"><a href="#6-One-Always-Block-FSM-style-Avoid" class="headerlink" title="6 One Always Block FSM style (Avoid)"></a>6 One Always Block FSM style (Avoid)</h3><h3 id="7-Onehot-FSM-Coding-style-Good-style"><a href="#7-Onehot-FSM-Coding-style-Good-style" class="headerlink" title="7 Onehot FSM Coding style. (Good style)"></a>7 Onehot FSM Coding style. (Good style)</h3><p>Onehot ç¼–ç ä¸äºŒè¿›åˆ¶ç¼–ç çš„æ ¸å¿ƒåœ¨äºparameterä¸å†ä»£è¡¨state encodingï¼Œè€Œæ˜¯ç”¨æ¥è¡¨ç¤ºstateå‘é‡çš„indexã€‚caseçš„è¯­å¥çš„æ¯”è¾ƒåˆ™ç®€åŒ–æˆå•ä¸ªbitçš„æ¯”è¾ƒã€‚</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Learning_Notes/FSM/images/4.%20onehot_coding.png" alt="Figure 5.Onehot FSM"></p>
<p>Onehot ç¼–ç ä¸äºŒè¿›åˆ¶ç¼–ç çš„æ ¸å¿ƒåœ¨äºparameterä¸å†ä»£è¡¨state encodingï¼Œè€Œæ˜¯ç”¨æ¥è¡¨ç¤ºstateå‘é‡çš„indexã€‚caseçš„è¯­å¥çš„æ¯”è¾ƒåˆ™ç®€åŒ–æˆå•ä¸ªbitçš„æ¯”è¾ƒã€‚</p>
<p>åœ¨caseè¯­å¥ä¸‹ï¼Œæ¯”è¾ƒè¿›å…¥åˆ†æ”¯æ—¶ï¼Œæœ¬èº«å¸¦æœ‰ä¼˜å…ˆçº§ï¼ˆå³ä»ç¬¬ä¸€ç§æƒ…å†µåˆ°defaultï¼‰ï¼Œå› è€Œè¿™æœ¬èº«ç»¼åˆå™¨ä¼šç»¼åˆä¸€ä¸ªç»„åˆé€»è¾‘çš„ä¼˜å…ˆçº§ç¼–ç å™¨ç”µè·¯ã€‚ç”±äºonehotç¼–ç æœ¬èº«ä¸å­˜åœ¨ä¼˜å…ˆçº§ï¼Œæ¯ä¸€ä¸ªcaseåœ¨é€»è¾‘ä¸Šæ˜¯å¹¶è¡Œï¼Œè¿™æ˜¯ä½œè€…å”¯ä¸€æ¨èä½¿ç”¨full_case å’Œ parallel_case è¯­å¥ï¼ˆå‘Šè¯‰ä»¿çœŸå™¨ 1. å·²ç»ç©·å°½äº†æ‰€æœ‰caseï¼Œä¸è¦ç”Ÿæˆé”å­˜å™¨ 2.æ¶ˆé™¤ä¼˜å…ˆçº§ç¼–ç å™¨ç”µè·¯ï¼‰</p>
<p>This is the only coding style where I recommend using full_case and parallel_case statements. The parallel case statement tells the synthesis tool to not build a priority encoder even though in theory, more than one of the state bits could be set (as engineers, we know that this is a onehot FSM and that only one bit can be set so no priority encoder is required). The value of the full_case statement is still in question.</p>
<p>Noteï¼šå¤šä¸ªè¾“å‡ºonehotç¼–ç ï¼Œä¼˜å…ˆç¼–ç å™¨</p>
<blockquote>
<p><a href="http://www.cburch.com/logisim/docs/2.3.0/libs/plexers/priencod.html">http://www.cburch.com/logisim/docs/2.3.0/libs/plexers/priencod.html</a></p>
</blockquote>
<p>å…³äºparallel_caseå’Œfull_caseçš„ä½¿ç”¨</p>
<blockquote>
<p><a href="https://blog.csdn.net/teenagerold/article/details/78022636?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-0&spm=1001.2101.3001.4242">https://blog.csdn.net/teenagerold/article/details/78022636?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-0&amp;spm=1001.2101.3001.4242</a></p>
</blockquote>
<blockquote>
<p><a href="https://blog.csdn.net/childbor/article/details/78633541?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-1&spm=1001.2101.3001.4242">https://blog.csdn.net/childbor/article/details/78633541?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-1&amp;spm=1001.2101.3001.4242</a></p>
</blockquote>
<h3 id="8-Registered-FSM-Output-Good-style"><a href="#8-Registered-FSM-Output-Good-style" class="headerlink" title="8 Registered FSM Output. (Good style)"></a>8 Registered FSM Output. (Good style)</h3><p>åœ¨è¾“å‡ºçº§åŠ ä¸€ä¸ªregisterå¯ä»¥ä¿è¯è¾“å‡ºæ²¡æœ‰glitchï¼Œä¼˜åŒ–ç»¼åˆç»“æœã€‚</p>
<p>Registering the outputs of an FSM design insures that the outputs are <strong>glitch-free</strong> and frequently improves synthesis results by standardizing the output and input delay constraints of synthesized modules.</p>
<p><img src="https://github.com/XuLixing/blog_images/raw/main/Learning_Notes/FSM/images/5.registeredFSM.png" alt="Figure 6.Registered FSM"></p>
<h3 id="9-System-Verilog-Enhancement"><a href="#9-System-Verilog-Enhancement" class="headerlink" title="9 System Verilog Enhancement"></a>9 System Verilog Enhancement</h3>]]></content>
      <categories>
        <category>FSM_verilog</category>
      </categories>
      <tags>
        <tag>FSM</tag>
      </tags>
  </entry>
</search>
